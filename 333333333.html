<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist de Estudos - Medicina Pro</title>
    <!-- √çcones via CDN -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- SEU CSS ORIGINAL --- */
        :root {
            /* TEMA CLARO (Padr√£o) */
            --primary: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #ec4899;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-light: #6b7280;
            --border: #e5e7eb;
            --input-bg: #ffffff;
            --hover-bg: #f8fafc;
            --header-gradient-start: #ffffff;
            --header-gradient-end: #f9fafb;
            --success-bg: #f0fdf4;
            --success-text: #15803d;
            --shadow-color: rgba(0, 0, 0, 0.05);
            --modal-overlay: rgba(0,0,0,0.5);
            --editor-toolbar-bg: #f1f5f9;
            --gradient: linear-gradient(135deg, #4f46e5 0%, #ec4899 100%);
            --danger-bg: #fee2e2;
            --danger-text: #b91c1c;
            --blue-bg: #dbeafe; /* Fundo azul para aprovados */
            --blue-text: #1e40af; /* Texto azul para aprovados */
            --highlight-active: #bfdbfe; /* Azul piscante para foco atual */
        }

        /* TEMA ESCURO */
        body.dark-mode {
            --bg-color: #111827;      /* Gray 900 */
            --card-bg: #1f2937;       /* Gray 800 */
            --text-main: #f3f4f6;     /* Gray 100 */
            --text-light: #9ca3af;    /* Gray 400 */
            --border: #374151;        /* Gray 700 */
            --input-bg: #374151;
            --hover-bg: #374151;
            --header-gradient-start: #1f2937;
            --header-gradient-end: #111827;
            --success-bg: #064e3b;    /* Dark Green */
            --success-text: #6ee7b7; /* Light Green Text */
            --shadow-color: rgba(0, 0, 0, 0.3);
            --modal-overlay: rgba(0,0,0,0.7);
            --editor-toolbar-bg: #111827;
            --danger-bg: #7f1d1d;
            --danger-text: #fca5a5;
            --blue-bg: #1e3a8a;
            --blue-text: #93c5fd;
            --highlight-active: #172554;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            padding: 20px;
            padding-bottom: 100px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            /* Altera√ß√£o: Container j√° inicia vis√≠vel */
            opacity: 1; 
            transition: opacity 1s;
        }

        /* --- LOGIN SCREEN (OCULTO) --- */
        #loginScreen {
            display: none !important; /* For√ßa oculta√ß√£o */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 5000;
            justify-content: center; align-items: center;
            flex-direction: column;
            transition: transform 0.5s ease-in-out, opacity 0.5s;
        }

        .login-card {
            background: var(--card-bg); padding: 40px; border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1); border: 1px solid var(--border);
            text-align: center; max-width: 400px; width: 90%;
        }

        .login-icon {
            font-size: 3rem; background: var(--gradient); -webkit-background-clip: text;
            -webkit-text-fill-color: transparent; margin-bottom: 20px;
        }

        .login-input {
            width: 100%; padding: 12px; margin: 10px 0; border: 1px solid var(--border);
            border-radius: 8px; background: var(--input-bg); color: var(--text-main);
            font-size: 1rem; outline: none;
        }
        .login-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }

        .btn-login {
            width: 100%; padding: 12px; background: var(--gradient); color: white;
            border: none; border-radius: 8px; font-weight: bold; font-size: 1rem;
            cursor: pointer; margin-top: 15px; transition: transform 0.2s;
        }
        .btn-login:hover { transform: scale(1.02); }

        .login-error { color: #ef4444; margin-top: 10px; font-size: 0.9rem; display: none; }
        
        .forgot-pass {
            display: block; margin-top: 15px; color: var(--primary); text-decoration: none; font-size: 0.9rem; cursor: pointer;
        }
        .forgot-pass:hover { text-decoration: underline; }

        /* Logout Message Overlay */
        #logoutMessage {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 5001;
            display: none; flex-direction: column;
            justify-content: center; align-items: center;
            font-size: 2rem; color: var(--primary); font-weight: bold;
            animation: fadeIn 0.5s;
        }
        #logoutMessage i { font-size: 3rem; margin-bottom: 20px; color: var(--secondary); }

        /* --- Header --- */
        header {
            background: var(--card-bg); padding: 25px; border-radius: 20px;
            box-shadow: 0 10px 25px -5px var(--shadow-color); margin-bottom: 30px;
            position: relative; overflow: hidden; text-align: center;
        }

        header::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 6px;
            background: var(--gradient);
        }

        h1 {
            font-size: 1.8rem; background: var(--gradient);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            font-weight: 800; display: inline-flex; align-items: center; gap: 10px;
        }

        /* Container de bot√µes centralizados abaixo do t√≠tulo */
        .header-actions {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn-manage {
            background: var(--bg-color); border: 1px solid var(--border);
            padding: 10px 16px; border-radius: 10px; cursor: pointer; color: var(--text-light);
            transition: all 0.2s; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 8px;
            font-weight: 600;
            text-decoration: none; /* For link buttons */
        }
        .btn-manage:hover { background: var(--hover-bg); color: var(--primary); border-color: var(--primary-light); transform: translateY(-2px); }
        .btn-manage.logout-btn:hover { color: #ef4444; border-color: #ef4444; background: var(--danger-bg); }

        /* --- COURSE TABS --- */
        .course-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
        }
        .course-tab {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text-light);
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .course-tab:hover {
            border-color: var(--primary-light);
            color: var(--primary);
        }
        .course-tab.active {
            background: var(--gradient);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
            transform: scale(1.05);
        }

        /* --- INDICADOR ONLINE --- */
        .online-status {
            display: inline-flex; align-items: center; gap: 6px; font-size: 0.8rem;
            color: var(--success-text); font-weight: 600; margin-left: 10px;
            padding: 4px 10px; background: var(--success-bg); border-radius: 20px;
            cursor: pointer; transition: transform 0.2s; border: 1px solid transparent;
        }
        .online-status:hover { transform: scale(1.05); border-color: var(--success-text); }
        .online-dot {
            width: 8px; height: 8px; background-color: #10b981; border-radius: 50%;
            box-shadow: 0 0 0 rgba(16, 185, 129, 0.4);
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        /* --- TIMER WIDGET --- */
        .timer-widget {
            position: fixed; bottom: 20px; right: 20px; width: 280px;
            background: var(--card-bg); border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); border: 1px solid var(--border);
            z-index: 100; overflow: hidden; transition: transform 0.3s;
        }
        .timer-widget.minimized { transform: translateY(calc(100% - 40px)); }
        
        .timer-header {
            background: var(--gradient); padding: 10px 15px; color: white;
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; font-weight: 600; font-size: 0.9rem;
        }
        
        .timer-tabs { display: flex; border-bottom: 1px solid var(--border); }
        .timer-tab {
            flex: 1; padding: 10px; text-align: center; cursor: pointer;
            font-size: 0.85rem; color: var(--text-light); background: var(--hover-bg);
        }
        .timer-tab.active { background: var(--card-bg); color: var(--primary); font-weight: bold; border-bottom: 2px solid var(--primary); }
        
        .timer-body { padding: 20px; text-align: center; }
        .timer-display { font-size: 2.5rem; font-weight: 700; color: var(--text-main); font-variant-numeric: tabular-nums; margin: 10px 0; }
        
        .timer-controls { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .btn-timer { padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: 0.2s; }
        .btn-start { background: #dcfce7; color: #15803d; }
        .btn-stop { background: #fee2e2; color: #b91c1c; }
        .btn-reset-timer { background: #f3f4f6; color: #4b5563; }
        body.dark-mode .btn-reset-timer { background: #374151; color: #d1d5db; }

        .pomodoro-settings { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 10px; font-size: 0.8rem; color: var(--text-light); }
        .inp-time { width: 50px; padding: 4px; border-radius: 4px; border: 1px solid var(--border); text-align: center; background: var(--input-bg); color: var(--text-main); }

        /* --- DASHBOARD --- */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .dash-card {
            background: var(--card-bg); border-radius: 20px; padding: 25px;
            box-shadow: 0 4px 20px var(--shadow-color); transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative; overflow: hidden; border: 1px solid var(--border);
        }
        .dash-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px var(--shadow-color); }
        .dash-title { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-light); font-weight: 600; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }

        .progress-circle-container { display: flex; align-items: center; justify-content: center; position: relative; height: 120px; }
        svg.progress-ring { width: 120px; height: 120px; transform: rotate(-90deg); }
        circle.progress-ring__circle-bg { stroke: var(--border); transition: stroke 0.3s; }
        circle.progress-ring__circle { stroke-dasharray: 326; stroke-dashoffset: 326; transition: stroke-dashoffset 1s ease-in-out; transform-origin: 50% 50%; }
        .progress-text-center { position: absolute; text-align: center; }
        .progress-text-center strong { display: block; font-size: 1.8rem; color: var(--primary); }
        .progress-text-center span { font-size: 0.8rem; color: var(--text-light); }

        .next-task-content h3 { font-size: 1.2rem; margin-bottom: 5px; color: var(--text-main); }
        .next-task-content p { font-size: 0.9rem; color: var(--text-light); margin-bottom: 15px; }
        .btn-focus { background: var(--gradient); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; width: 100%; transition: opacity 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-focus:hover { opacity: 0.9; }

        .mini-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .stat-item { background: var(--bg-color); padding: 15px; border-radius: 12px; text-align: center; border: 1px solid var(--border); }
        .stat-icon { font-size: 1.2rem; margin-bottom: 5px; color: var(--secondary); }
        .stat-value { font-size: 1.4rem; font-weight: 700; color: var(--text-main); }
        .stat-label { font-size: 0.75rem; color: var(--text-light); }

        .greeting-section { margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap;}
        .greeting-content h2 { font-size: 1.5rem; color: var(--text-main); margin-bottom: 5px;}
        .greeting-content p { color: var(--text-light); }

        /* Lista e Tabela */
        .week-card { background: var(--card-bg); border-radius: 16px; margin-bottom: 20px; box-shadow: 0 4px 6px -1px var(--shadow-color); border: 1px solid var(--border); }
        .week-header { padding: 20px 25px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 700; font-size: 1.15rem; color: var(--text-main); background: linear-gradient(to right, var(--header-gradient-start), var(--header-gradient-end)); border-bottom: 1px solid transparent; border-radius: 16px; transition: all 0.3s; }
        .week-card.active .week-header { border-bottom: 1px solid var(--border); border-bottom-left-radius: 0; border-bottom-right-radius: 0; color: var(--primary); }
        .week-header i { transition: transform 0.3s; color: var(--secondary); }
        .week-card.active .week-header i { transform: rotate(180deg); }
        .week-content { display: none; padding: 5px 0; animation: slideDown 0.3s ease-out; }
        .week-card.active .week-content { display: block; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .topic-list { width: 100%; border-collapse: collapse; }
        th { padding: 15px; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-light); font-weight: 600; }
        td { padding: 12px 15px; border-bottom: 1px solid var(--border); vertical-align: middle; }
        tr:last-child td { border-bottom: none; }
        tr:hover td { background-color: var(--hover-bg); }
        .topic-title-cell { width: 45%; }
        .topic-title-content { display: flex; align-items: center; gap: 12px; }
        .topic-text { font-size: 0.95rem; line-height: 1.5; color: var(--text-main); cursor: default; }
        .topic-text.has-video { color: var(--primary); cursor: pointer; font-weight: 600; text-decoration: underline; text-underline-offset: 4px; transition: color 0.2s; }
        .topic-text.has-video:hover { color: var(--secondary); }
        .topic-text.has-video i { margin-right: 5px; color: var(--secondary); }

        .note-btn { background: none; border: none; cursor: pointer; padding: 6px; border-radius: 50%; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; }
        .note-btn.empty { color: #94a3b8; background: var(--bg-color); border: 1px solid var(--border); }
        .note-btn.empty:hover { border-color: var(--primary); color: var(--primary); }
        .note-btn.has-note { color: white; background: var(--gradient); box-shadow: 0 2px 5px rgba(236, 72, 153, 0.3); border: none; }
        
        .checkbox-cell { text-align: center; width: 10%; }
        .custom-checkbox { position: relative; display: inline-block; width: 24px; height: 24px; cursor: pointer; }
        .custom-checkbox input { opacity: 0; width: 0; height: 0; }
        .checkmark { position: absolute; top: 0; left: 0; height: 24px; width: 24px; background-color: var(--card-bg); border: 2px solid var(--border); border-radius: 6px; transition: all 0.2s; }
        .custom-checkbox input:checked ~ .checkmark { border-color: transparent; transform: scale(1.05); }
        .checkmark::after { content: ""; position: absolute; display: none; left: 8px; top: 4px; width: 5px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg); }
        .custom-checkbox input:checked ~ .checkmark::after { display: block; }
        .cb-aula input:checked ~ .checkmark { background-color: #3b82f6; }
        .cb-tarefa input:checked ~ .checkmark { background-color: #8b5cf6; }
        .cb-flash input:checked ~ .checkmark { background-color: #f59e0b; }
        .cb-rev input:checked ~ .checkmark { background-color: #10b981; }
        tr.completed td { background-color: var(--success-bg); }
        tr.completed .topic-text { color: var(--success-text); font-weight: 500; text-decoration: line-through; opacity: 0.8; }

        /* Modais */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--modal-overlay); z-index: 999; backdrop-filter: blur(4px); }
        .modal-window { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 600px; background: var(--card-bg); border-radius: 16px; box-shadow: 0 20px 50px rgba(0,0,0,0.4); z-index: 1000; border: 1px solid var(--border); flex-direction: column; max-height: 85vh; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); color: var(--text-main); }
        
        /* Maximize Modal Class */
        .modal-window.maximized {
            width: 100vw !important;
            height: 100vh !important;
            max-width: 100vw !important;
            max-height: 100vh !important;
            top: 0 !important;
            left: 0 !important;
            transform: none !important;
            border-radius: 0 !important;
            margin: 0 !important;
        }
        .modal-window.maximized .modal-body { height: calc(100vh - 120px); }

        #managerModal, #readNoteModal, #videoManagerModal { max-width: 800px; }
        #simuladosModal, #statsModal { max-width: 95%; width: 95%; height: 90vh; }
        #welcomeModal { text-align: center; }
        
        /* --- FLOATING PDF WINDOW --- */
        .floating-window {
            position: fixed; top: 100px; left: 100px; width: 600px; height: 700px;
            background: var(--card-bg); border-radius: 12px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            border: 1px solid var(--border); z-index: 2000; display: none; flex-direction: column;
            resize: both; overflow: hidden; min-width: 300px; min-height: 300px;
        }
        .fw-header {
            padding: 10px 15px; background: var(--editor-toolbar-bg); cursor: move;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border); user-select: none;
        }
        .fw-controls { display: flex; gap: 8px; }
        .btn-tool {
            width: 28px; height: 28px; border: 1px solid var(--border); background: var(--card-bg);
            border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 0.9rem;
        }
        .btn-tool:hover { background: var(--hover-bg); }
        .btn-tool.active { background: var(--highlight-active); border-color: var(--primary); }
        .btn-tool.yellow { background: #fef08a; border-color: #fde047; color: #854d0e; font-weight: bold; }
        .btn-tool.blue { background: #bae6fd; border-color: #7dd3fc; color: #0369a1; font-weight: bold; }
        
        .fw-body { flex: 1; position: relative; overflow: hidden; background: #525659; }
        .fw-body iframe { width: 100%; height: 100%; border: none; }
        
        /* Overlay for highlighting */
        #highlightCanvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* Allows click through to PDF normally */
        }
        .drawing-mode #highlightCanvas {
            pointer-events: auto; /* Blocks PDF interaction to draw */
            cursor: crosshair;
        }

        /* --- PLAYER MODAL UPDATED (TELA GRANDE & SCROLL UNIFICADO) --- */
        #playerModal { 
            background: #0f0f0f; color: #fff; border: 1px solid #333; 
            width: 98%; max-width: 1600px; height: 95vh; /* Altura ajustada para 95% da viewport */
            display: none; flex-direction: column; 
        }
        #playerModal .modal-header { background: #181818; border-bottom: 1px solid #333; color: #fff; padding: 15px 20px; flex-shrink: 0; }
        #playerModal .modal-title { color: #fff; font-size: 1.1rem; }
        #playerModal .modal-body { padding: 0; background: #0f0f0f; display: flex; flex: 1; overflow: hidden; }
        
        .player-layout { display: flex; width: 100%; height: 100%; }
        
        /* Left: Screen + Comments - UNIFIED SCROLL */
        .player-main-col { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            overflow-y: auto; /* Scrola a coluna toda (video + comentarios) */
            background: #0f0f0f; 
            border-right: 1px solid #333; 
        }
        
        /* Player Screen: Adjusted to be responsive and bigger */
        .player-screen { 
            width: 100%; 
            aspect-ratio: 16/9; 
            background: #000; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            position: relative; 
            border-bottom: 1px solid #333; 
            flex-shrink: 0; /* N√£o encolher */
            min-height: 300px; /* Reduzido para evitar quebrar em telas pequenas */
            max-height: 60vh; /* Limita a altura do v√≠deo para n√£o ocupar a tela toda */
        }
        .player-screen iframe { width: 100%; height: 100%; border: none; }
        .player-placeholder { text-align: center; color: #666; }
        .player-placeholder i { font-size: 3rem; margin-bottom: 15px; }

        /* Right Column Wrapper */
        .player-sidebar {
            width: 350px;
            background: #181818;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            border-left: 1px solid #333;
        }

        /* Header */
        .playlist-header {
            padding: 15px;
            border-bottom: 1px solid #333;
            font-weight: bold;
            font-size: 1rem;
            background: #222;
            flex-shrink: 0;
        }

        /* Scrollable List */
        .player-playlist-items {
            flex: 1;
            overflow-y: auto;
        }

        .playlist-item { padding: 15px; border-bottom: 1px solid #2a2a2a; cursor: pointer; transition: background 0.2s; display: flex; align-items: center; gap: 10px; }
        .playlist-item:hover { background: #2a2a2a; }
        
        /* Resources Footer in Sidebar */
        .player-resources-sidebar {
            padding: 15px;
            border-top: 1px solid #333;
            background: #1a1a1a;
            display: none; /* Hidden by default */
            flex-direction: column;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .btn-resource-sidebar {
            background: #2a2a2a; border: 1px solid #444; color: #e5e5e5;
            padding: 10px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;
            font-size: 0.9rem; transition: 0.2s; text-align: left;
        }
        .btn-resource-sidebar:hover { background: #333; border-color: var(--primary); color: white; }

        /* Playlist States */
        .playlist-item.watching { background: #14532d; border-left: 4px solid #4ade80; }
        .playlist-item.watching .vid-title { color: #fff; font-weight: bold; }
        .playlist-item.watching .vid-title::after { content: " (Assistindo...)"; font-size: 0.7rem; color: #4ade80; opacity: 0.8; font-weight: normal; margin-left: 5px; }
        
        .playlist-item.watched .vid-title { color: #aaa; }
        .playlist-item.watched .vid-title::after { content: " (Visto)"; font-size: 0.7rem; color: #4ade80; font-weight: bold; margin-left: 5px; }
        .playlist-item i { color: #666; width: 20px; text-align: center; }
        .playlist-item.watched i { color: #4ade80; }
        .playlist-item.watching i { color: #fff; animation: spin 2s infinite linear; }

        .vid-title { font-size: 0.9rem; line-height: 1.4; color: #ddd; flex: 1; }

        .player-controls-bottom { padding: 15px; width: 100%; display: flex; justify-content: space-between; align-items: center; background: #181818; border-top: 1px solid #333; flex-shrink: 0; }

        /* Comments Apple Style */
        .comments-section { padding: 25px; background: #181818; color: #eee; flex-grow: 1; min-height: 300px; }
        .comment-input-container { display: flex; gap: 12px; margin-bottom: 25px; align-items: flex-start; }
        .apple-avatar { width: 36px; height: 36px; background: var(--gradient); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; font-size: 0.9rem; flex-shrink: 0; }
        .comment-field { flex: 1; background: #2a2a2a; border: none; border-radius: 18px; padding: 12px 15px; color: white; resize: none; font-size: 0.95rem; outline: none; min-height: 40px; transition: min-height 0.2s; }
        .comment-field:focus { min-height: 80px; background: #333; box-shadow: 0 0 0 2px var(--primary); }
        .btn-comment { background: #007aff; color: white; border: none; padding: 8px 20px; border-radius: 20px; font-weight: 600; cursor: pointer; align-self: flex-end; font-size: 0.9rem; margin-top: 5px; }
        .btn-comment:hover { opacity: 0.9; }

        .comment-list { display: flex; flex-direction: column; gap: 15px; padding-bottom: 20px; }
        .comment-item { display: flex; gap: 12px; animation: popIn 0.3s ease; }
        .comment-content { flex: 1; background: #262626; padding: 10px 15px; border-radius: 18px; border-top-left-radius: 4px; position: relative; max-width: 90%; }
        .comment-author { font-weight: 700; font-size: 0.85rem; color: #007aff; margin-bottom: 4px; display: flex; justify-content: space-between; }
        .comment-text { font-size: 0.95rem; line-height: 1.4; color: #e5e5e5; }
        .comment-date { font-size: 0.7rem; color: #888; margin-top: 6px; text-align: right; }
        .btn-delete-comment { background: none; border: none; color: #ff3b30; cursor: pointer; font-size: 0.75rem; opacity: 0; transition: 0.2s; }
        .comment-item:hover .btn-delete-comment { opacity: 1; }
        
        @media (max-width: 900px) {
            .player-layout { flex-direction: column; }
            .player-sidebar { width: 100%; height: auto; max-height: 300px; border-left: none; border-top: 1px solid #333; }
            .player-main-col { overflow: visible; } 
        }

        @keyframes popIn { from { opacity: 0; transform: translate(-50%, -60%) scale(0.95); } to { opacity: 1; transform: translate(-50%, -50%) scale(1); } }
        
        .modal-header { background: linear-gradient(to right, var(--header-gradient-start), var(--card-bg)); padding: 15px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; border-radius: 16px 16px 0 0; }
        .modal-title { font-weight: 700; color: var(--text-main); font-size: 1.1rem; }
        .modal-close-btn { background: none; border: none; font-size: 1.2rem; color: var(--text-light); cursor: pointer; transition: color 0.2s;}
        .modal-close-btn:hover { color: #ef4444; }
        .modal-body { padding: 20px; overflow-y: auto; flex: 1; }
        .modal-footer { padding: 15px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 10px; background: var(--card-bg); border-radius: 0 0 16px 16px; }

        /* Simulados Table & Scrolling Logic */
        #simuladosModal .modal-body {
            padding: 0;
            overflow: hidden; /* Hide body scroll, rely on container */
            display: flex;
            flex-direction: column;
        }

        .simulados-container { 
            overflow: auto; /* Both X and Y */
            flex: 1;
            padding: 20px;
            width: 100%;
        }
        
        /* Custom Scrollbar for Simulados */
        .simulados-container::-webkit-scrollbar { 
            height: 14px; /* Horizontal */
            width: 14px;  /* Vertical */
        }
        .simulados-container::-webkit-scrollbar-track { 
            background: var(--bg-color); 
        }
        .simulados-container::-webkit-scrollbar-thumb { 
            background-color: var(--primary-light); 
            border-radius: 10px; 
            border: 3px solid var(--bg-color); 
        }
        .simulados-container::-webkit-scrollbar-corner {
            background: var(--bg-color);
        }

        .simulados-table { width: 100%; border-collapse: collapse; min-width: 1500px; font-size: 0.85rem; }
        .simulados-table th { background: var(--hover-bg); border: 1px solid var(--border); padding: 8px; text-align: center; }
        .simulados-table td { border: 1px solid var(--border); padding: 5px; text-align: center; transition: background-color 0.5s; }
        .simulados-table input[type="date"], 
        .simulados-table input[type="number"] { width: 100%; border: none; background: transparent; color: var(--text-main); text-align: center; }
        .simulados-table input[type="number"] { width: 50px; }
        .sim-header-group { background: var(--primary-light); color: white !important; }
        .status-ok { color: #10b981; font-weight: bold; }
        .status-bad { color: #ef4444; font-weight: bold; }
        .sugestao-box { font-size: 0.75rem; color: var(--primary); font-style: italic; white-space: pre-wrap; }
        .meta-control { background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 6px; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; }
        .meta-input { width: 50px; background: rgba(255,255,255,0.9); border: none; border-radius: 4px; padding: 2px; text-align: center; font-weight: bold; color: #333; }
        
        /* Cores de Desempenho no Simulado */
        .sim-row-danger { background-color: var(--danger-bg); }
        .sim-row-danger td { border-color: rgba(0,0,0,0.1); }
        .sim-row-danger input { color: var(--danger-text); font-weight: bold; }
        
        .sim-row-success { background-color: var(--blue-bg); }
        .sim-row-success td { border-color: rgba(0,0,0,0.1); }
        .sim-row-success input, .sim-row-success td { color: var(--blue-text); font-weight: bold; }

        /* Azul Piscante para Tema Atual */
        .sim-row-active { 
            animation: blinkRow 2s infinite; 
            background-color: var(--highlight-active) !important; 
        }
        .sim-row-active input, .sim-row-active td { color: var(--blue-text); font-weight: bold; }

        @keyframes blinkRow { 0%{opacity:1;} 50%{opacity:0.7;} 100%{opacity:1;} }

        /* Stats Modal */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .stat-card-big { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .stat-title { font-size: 1.1rem; color: var(--text-light); margin-bottom: 15px; font-weight: 600; display:flex; justify-content: space-between; }
        .stat-highlight { font-size: 2rem; font-weight: bold; color: var(--primary); display:block; }
        .stat-subtext { font-size: 0.9rem; color: var(--text-light); }
        
        /* Bar Chart CSS */
        .bar-chart { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .bar-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; }
        .bar-label { width: 40px; font-weight: bold; }
        .bar-track { flex: 1; height: 10px; background: var(--border); border-radius: 5px; overflow: hidden; }
        .bar-fill { height: 100%; background: var(--gradient); width: 0; transition: width 1s; }
        .bar-val { width: 40px; text-align: right; font-size: 0.8rem; }

        /* Manager styles */
        .manager-list { list-style: none; }
        .manager-week { margin-bottom: 20px; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        .manager-week-header { background: var(--bg-color); padding: 10px; display: flex; gap: 10px; align-items: center; border-bottom: 1px solid var(--border); }
        .manager-week-body { padding: 10px; background: var(--card-bg); }
        .manager-topic-list { list-style: none; padding-left: 20px; }
        .manager-topic-item { display: flex; gap: 10px; margin-bottom: 8px; align-items: center; }
        .inp-text { flex: 1; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 0.9rem; background: var(--input-bg); color: var(--text-main); }
        .inp-text:focus { border-color: var(--primary); outline: none; }
        .btn-icon { padding: 8px; border: none; background: #fee2e2; color: #ef4444; border-radius: 4px; cursor: pointer; transition: 0.2s; }
        .btn-icon:hover { background: #fecaca; }
        .btn-icon-blue { background: #e0f2fe; color: #0284c7; }
        .btn-icon-blue:hover { background: #bae6fd; }
        body.dark-mode .btn-icon { background: #7f1d1d; color: #fca5a5; }
        body.dark-mode .btn-icon:hover { background: #991b1b; }
        body.dark-mode .btn-icon-blue { background: #0c4a6e; color: #7dd3fc; }
        body.dark-mode .btn-icon-blue:hover { background: #075985; }
        .btn-add { background: #dcfce7; color: #166534; width: 100%; margin-top: 5px; }
        body.dark-mode .btn-add { background: #14532d; color: #86efac; }
        .btn-add:hover { opacity: 0.9; }
        .btn-primary { background: var(--primary); color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;}
        .btn-secondary { background: var(--bg-color); color: var(--text-main); padding: 10px 20px; border: 1px solid var(--border); border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;}
        .btn-secondary:hover { background: var(--hover-bg); }

        /* Notes & Read */
        .notes-list-item { background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; }
        .notes-list-item:hover { transform: translateX(5px); border-color: var(--primary-light); box-shadow: 0 4px 6px -1px var(--shadow-color); }
        .note-meta { font-size: 0.8rem; color: var(--text-light); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
        .note-title { font-weight: 600; color: var(--text-main); font-size: 1.05rem; }
        .note-actions { display: flex; gap: 8px; }
        .read-mode-content { padding: 40px; background: var(--card-bg); font-size: 1.1rem; line-height: 1.8; color: var(--text-main); font-family: 'Georgia', 'Times New Roman', serif; border: 1px solid var(--border); min-height: 300px; width: 100%; overflow-wrap: break-word; word-wrap: break-word; text-align: justify; }
        .read-mode-content h1, .read-mode-content h2, .read-mode-content h3 { color: var(--text-main); margin-top: 1em; }
        body.dark-mode .read-mode-content { background: #1e293b; color: #e2e8f0; border-color: #334155; }
        .read-mode-content img { max-width: 100%; height: auto; display: block; margin: 10px auto; }

        /* Editor */
        .editor-toolbar { padding: 10px; background: var(--editor-toolbar-bg); border-bottom: 1px solid var(--border); display: flex; gap: 8px; flex-wrap: wrap; }
        .tool-btn { background: var(--card-bg); border: 1px solid var(--border); border-radius: 6px; padding: 6px 10px; cursor: pointer; color: var(--text-main); }
        .tool-btn:hover { background: var(--hover-bg); }
        .color-picker { display: flex; gap: 4px; align-items: center; padding: 0 8px; border-left: 1px solid var(--border); }
        .color-dot { width: 18px; height: 18px; border-radius: 50%; cursor: pointer; border: 1px solid rgba(0,0,0,0.1); }
        #editorContent { min-height: 200px; padding: 20px; outline: none; line-height: 1.6; color: var(--text-main); }
        
        .btn-reset { color: #ef4444; background: none; border: 1px solid #ef4444; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-top: 20px; width: 100%; display: block; }
        
        /* --- LOADING OVERLAY (NOVO PARA ONLINE) --- */
        #loadingOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 9999; display: none; flex-direction: column;
            justify-content: center; align-items: center; color: var(--primary);
            font-weight: bold;
        }
        .spinner {
            width: 50px; height: 50px; border: 5px solid var(--border);
            border-top: 5px solid var(--primary); border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- PDF READER MODAL (NEW) --- */
        #pdfReaderModal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 6000;
            display: none; flex-direction: column;
            animation: fadeIn 0.3s;
        }
        #pdfReaderModal .reader-header {
            background: #222; color: #fff; padding: 15px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #444;
        }
        #pdfReaderModal .reader-title { font-weight: bold; font-size: 1.1rem; }
        #pdfReaderModal .reader-close {
            background: #ef4444; color: white; border: none; padding: 5px 12px;
            border-radius: 6px; cursor: pointer; font-weight: bold;
        }
        #pdfReaderModal .reader-body { flex: 1; background: #333; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        .pdf-frame { width: 95%; height: 95%; border: none; background: #fff; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<!-- LOADING -->
<div id="loadingOverlay">
    <div class="spinner"></div>
    <p>Sincronizando com a nuvem...</p>
</div>

<!-- LOGIN (OCULTO) -->
<div id="loginScreen">
    <div class="login-card">
        <div class="login-icon"><i class="fas fa-user-md"></i></div>
        <h2 style="margin-bottom: 5px;">Acesso Restrito</h2>
        <p style="color: var(--text-light); margin-bottom: 20px;">√Årea do Estudante de Medicina</p>
        <input type="text" id="loginName" class="login-input" placeholder="Seu Nome" autocomplete="off">
        <input type="password" id="loginPass" class="login-input" placeholder="Senha de Acesso" onkeypress="handleEnter(event)">
        <button class="btn-login" onclick="attemptLogin()">Entrar</button>
        <a href="#" onclick="forgotPassword()" class="forgot-pass">Esqueci a senha</a>
        <p id="loginError" class="login-error">Credenciais inv√°lidas. Tente novamente.</p>
    </div>
</div>

<!-- LOGOUT MESSAGE -->
<div id="logoutMessage">
    <i class="fas fa-hand-holding-heart"></i>
    <div>Volte logo üëã</div>
</div>

<div class="container" id="mainContainer">
    <header>
        <h1><i class="fas fa-stethoscope"></i> Medicina Pro</h1>
        <p style="color: var(--text-light); margin-top: 5px;">Cronograma de Aprova√ß√£o</p>
        
        <div class="header-actions">
            <button class="btn-manage" onclick="toggleTheme()" title="Alternar Tema">
                <i class="fas fa-moon" id="themeIcon"></i>
            </button>
            <button class="btn-manage" onclick="openSimulados()">
                <i class="fas fa-chart-line"></i> Simulados
            </button>
            <button class="btn-manage" onclick="openVideoManager()">
                <i class="fas fa-video"></i> Aulas / PDFs
            </button>
            <button class="btn-manage" onclick="openAllNotes()">
                <i class="fas fa-book"></i> Meus Resumos
            </button>
            <button class="btn-manage" onclick="openManager()">
                <i class="fas fa-cog"></i> Editar Cronograma
            </button>
            <button class="btn-manage logout-btn" onclick="logout()" title="Sair do sistema">
                <i class="fas fa-power-off"></i>
            </button>
        </div>
    </header>

    <div class="greeting-section">
        <div class="greeting-content">
            <h2 id="greetingMsg">Boa noite, Doutor(a)!</h2>
            <p>Vamos em busca da aprova√ß√£o hoje?</p>
        </div>
        <!-- Menu Online com Desempenho -->
        <div class="online-status" onclick="openStats()" title="Ver Desempenho Geral">
            <div class="online-dot"></div> Online
        </div>
    </div>

    <!-- ABAS DO CURSO -->
    <div class="course-tabs">
        <button class="course-tab active" onclick="switchCourse('main')" id="tab-main">Extensivo Padr√£o</button>
        <button class="course-tab" onclick="switchCourse('medcof')" id="tab-medcof">Medcof</button>
    </div>

    <!-- DASHBOARD -->
    <div class="dashboard-grid">
        <div class="dash-card">
            <div class="dash-title">
                <span>Progresso Geral</span>
                <i class="fas fa-chart-pie" style="color: var(--primary)"></i>
            </div>
            <div class="progress-circle-container">
                <svg class="progress-ring">
                    <circle class="progress-ring__circle-bg" stroke-width="8" fill="transparent" r="52" cx="60" cy="60"/>
                    <circle class="progress-ring__circle" id="circleProgress" stroke="url(#gradient)" stroke-width="8" stroke-linecap="round" fill="transparent" r="52" cx="60" cy="60"/>
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#4f46e5" />
                            <stop offset="100%" stop-color="#ec4899" />
                        </linearGradient>
                    </defs>
                </svg>
                <div class="progress-text-center">
                    <strong id="dashPercent">0%</strong>
                    <span id="dashFraction">0/0</span>
                </div>
            </div>
        </div>

        <div class="dash-card highlight">
            <div class="dash-title">
                <span>Pr√≥ximo Passo</span>
                <i class="fas fa-crosshairs" style="color: var(--secondary)"></i>
            </div>
            <div class="next-task-content">
                <h3 id="nextTaskTitle">Tudo conclu√≠do!</h3>
                <p id="nextTaskWeek">Parab√©ns pelo progresso.</p>
                <button class="btn-focus" id="btnFocus" onclick="goToNextTask()">
                    <i class="fas fa-play"></i> Estudar Agora
                </button>
            </div>
        </div>

        <div class="dash-card">
            <div class="dash-title">
                <span>Produtividade</span>
                <i class="fas fa-bolt" style="color: #f59e0b"></i>
            </div>
            <div class="mini-stats">
                <div class="stat-item">
                    <div class="stat-icon"><i class="fas fa-book-open"></i></div>
                    <div class="stat-value" id="notesCount">0</div>
                    <div class="stat-label">Resumos</div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon"><i class="fas fa-fire-alt" style="color: #f59e0b"></i></div>
                    <div class="stat-value" id="topicCount">0</div>
                    <div class="stat-label">T√≥picos OK</div>
                </div>
            </div>
        </div>
    </div>

    <div id="app"></div>
    <button class="btn-reset" onclick="resetAll()"><i class="fas fa-trash-alt"></i> Resetar Todo o Progresso (Aba Atual)</button>
</div>

<!-- TIMER -->
<div class="timer-widget" id="timerWidget">
    <div class="timer-header" onclick="toggleTimerWidget()">
        <span id="timerTitle"><i class="fas fa-hourglass-half"></i> Foco</span>
        <i class="fas fa-chevron-down" id="timerToggleIcon"></i>
    </div>
    <div class="timer-tabs">
        <div class="timer-tab active" onclick="switchTimerTab('pomodoro')" id="tabPomodoro">Pomodoro</div>
        <div class="timer-tab" onclick="switchTimerTab('stopwatch')" id="tabStopwatch">Cron√¥metro</div>
    </div>
    <div class="timer-body" id="bodyPomodoro">
        <div class="timer-display" id="pomoDisplay">25:00</div>
        <div class="timer-controls">
            <button class="btn-timer btn-start" onclick="startPomodoro()" id="btnStartPomo">Iniciar</button>
            <button class="btn-timer btn-reset-timer" onclick="resetPomodoro()">Reset</button>
        </div>
        <div class="pomodoro-settings">
            <span>Tempo (min):</span>
            <input type="number" id="pomoInput" class="inp-time" value="25" min="1" max="120" onchange="resetPomodoro()">
        </div>
    </div>
    <div class="timer-body" id="bodyStopwatch" style="display:none;">
        <div class="timer-display" id="swDisplay">00:00:00</div>
        <div class="timer-controls">
            <button class="btn-timer btn-start" onclick="startStopwatch()" id="btnStartSw">Iniciar</button>
            <button class="btn-timer btn-reset-timer" onclick="resetStopwatch()">Zerar</button>
        </div>
    </div>
</div>

<!-- FLOATING PDF WINDOW -->
<div id="pdfFloatingWindow" class="floating-window">
    <div class="fw-header" id="fwHeader">
        <span><i class="fas fa-file-pdf" style="color: #ef4444; margin-right: 8px;"></i>Material de Apoio</span>
        <div class="fw-controls">
            <button onclick="toggleHighlight('yellow')" class="btn-tool yellow" title="Marca Texto Amarelo">A</button>
            <button onclick="toggleHighlight('blue')" class="btn-tool blue" title="Marca Texto Azul">A</button>
            <button onclick="clearCanvas()" class="btn-tool" title="Limpar Desenhos"><i class="fas fa-eraser"></i></button>
            <button onclick="closePDFViewer()" class="btn-tool" title="Fechar"><i class="fas fa-times"></i></button>
        </div>
    </div>
    <div class="fw-body">
        <iframe id="pdfFrame" src=""></iframe>
        <canvas id="highlightCanvas"></canvas>
    </div>
</div>

<div class="modal-overlay" id="modalOverlay" onclick="closeAllModals()"></div>

<!-- MODAL WELCOME -->
<div id="welcomeModal" class="modal-window">
    <div class="modal-body" style="text-align: center; padding: 40px 20px;">
        <i class="fas fa-user-md" style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"></i>
        <h2 id="welcomeTitle" style="color: var(--text-main); margin-bottom: 10px;">Seja bem vindo, Doutor!</h2>
        <p id="welcomeText" style="color: var(--text-light); font-size: 1.1rem; line-height: 1.6; margin-bottom: 30px;">
            Hoje temos que come√ßar no tema...
        </p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button class="btn-secondary" onclick="closeAllModals()" title="Fechar">
                <i class="fas fa-times"></i> Fechar
            </button>
            <button class="btn-primary" onclick="goToNextTaskFromWelcome()" title="Ir para o tema">
                <i class="fas fa-check"></i> Vamos l√°
            </button>
        </div>
    </div>
</div>

<!-- MODAL SIMULADOS -->
<div id="simuladosModal" class="modal-window">
    <div class="modal-header">
        <div class="modal-title" style="display:flex; align-items:center; gap:15px;">
            <span><i class="fas fa-chart-line" style="color: var(--primary)"></i> Simulados</span>
            <div class="meta-control">
                <span>Meta Global:</span>
                <input type="number" id="metaInput" class="meta-input" value="70" onchange="saveMeta(this.value)"> 
                <span>%</span>
            </div>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="modal-close-btn" onclick="toggleMaximize('simuladosModal')" title="Maximizar">üì∫</button>
            <button class="modal-close-btn" onclick="closeAllModals()"><i class="fas fa-times"></i></button>
        </div>
    </div>
    <div class="modal-body">
        <div class="simulados-container">
            <table class="simulados-table" id="simuladosTableBody">
                <!-- JS -->
            </table>
        </div>
    </div>
</div>

<!-- MODAL VIDEO MANAGER -->
<div id="videoManagerModal" class="modal-window">
    <div class="modal-header">
        <div class="modal-title"><i class="fas fa-video" style="color: var(--primary)"></i> Gerenciar Aulas</div>
        <button class="modal-close-btn" onclick="closeAllModals()"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body" id="videoManagerBody">
        <!-- Content -->
    </div>
</div>

<!-- MODAL PLAYER (YOUTUBE/NETFLIX STYLE) - ATUALIZADO -->
<div id="playerModal" class="modal-window">
    <div class="modal-header">
        <div class="modal-title" id="playerTitle">Assistir Aula</div>
        <button class="modal-close-btn" onclick="closeAllModals()"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body">
        <div class="player-layout">
            <!-- Left Column: Video + Comments - UNIFIED SCROLL -->
            <div class="player-main-col">
                <!-- Video Screen -->
                <div class="player-screen" id="playerScreen">
                    <div class="player-placeholder" id="playerPlaceholder">
                        <i class="fas fa-play-circle"></i>
                        <h3 style="margin-top:20px; color:#fff;">Selecione um v√≠deo ao lado</h3>
                    </div>
                </div>
                
                <!-- Apple Style Comments -->
                <div class="comments-section">
                    <h3 style="margin-bottom: 15px; font-size: 1.1rem; font-weight:600;">Coment√°rios e Anota√ß√µes</h3>
                    <div class="comment-input-container">
                        <div class="apple-avatar" id="userInitial">H</div>
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                            <textarea id="commentText" class="comment-field" placeholder="Escreva uma anota√ß√£o sobre esta aula..."></textarea>
                            <button class="btn-comment" onclick="addComment()">Publicar</button>
                        </div>
                    </div>
                    <div class="comment-list" id="commentList">
                        <!-- Coment√°rios aqui -->
                    </div>
                </div>
            </div>
            
            <!-- Right: Playlist Column -->
             <div class="player-sidebar">
                <div class="playlist-header">Playlist de Aulas</div>
                <div class="player-playlist-items" id="playerPlaylist">
                    <!-- Items injected here -->
                </div>
                <div class="player-resources-sidebar" id="playerResources">
                    <!-- Resources injected here -->
                </div>
            </div>
        </div>
    </div>
    <div class="player-controls-bottom">
         <span style="color:#aaa; font-size:0.9rem;">Dica: Coment√°rios s√£o salvos por v√≠deo.</span>
         <button class="btn-secondary" id="markWatchedBtn" onclick="toggleWatchedStatus()" style="border-color:#4ade80; color:#4ade80; background:transparent;">
            <i class="fas fa-check-double"></i> Marcar/Desmarcar como Visto
        </button>
    </div>
</div>

<!-- MODAL ESTAT√çSTICAS (NOVO) -->
<div id="statsModal" class="modal-window">
    <div class="modal-header">
        <div class="modal-title"><i class="fas fa-poll" style="color: var(--secondary)"></i> Estat√≠sticas & Desempenho</div>
        <button class="modal-close-btn" onclick="closeAllModals()"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body" style="background: var(--bg-color);">
        <div id="statsContent">
            <!-- Gerado via JS -->
        </div>
    </div>
</div>

<!-- MODAL EDITOR -->
<div id="noteModal" class="modal-window">
    <div class="modal-header">
        <div class="modal-title">
            <i class="fas fa-pen-fancy" style="color: var(--secondary)"></i>
            <span id="noteTopicTitle">T√≠tulo do T√≥pico</span>
        </div>
        <button class="modal-close-btn" onclick="closeAllModals()"><i class="fas fa-times"></i></button>
    </div>
    <div class="editor-toolbar">
        <button class="tool-btn" onclick="formatDoc('bold')" title="Negrito"><b>B</b></button>
        <button class="tool-btn" onclick="formatDoc('italic')" title="It√°lico"><i>I</i></button>
        <button class="tool-btn" onclick="formatDoc('underline')" title="Sublinhado"><u>U</u></button>
        <div class="color-picker">
            <div class="color-dot" style="background:#fef08a" onclick="formatDoc('hiliteColor', '#fef08a')" title="Amarelo"></div>
            <div class="color-dot" style="background:#bbf7d0" onclick="formatDoc('hiliteColor', '#bbf7d0')" title="Verde"></div>
            <div class="color-dot" style="background:#fbcfe8" onclick="formatDoc('hiliteColor', '#fbcfe8')" title="Rosa"></div>
            <div class="color-dot" style="background:transparent; border:1px solid #999; display:flex; align-items:center; justify-content:center; font-size:10px;" onclick="formatDoc('removeFormat')" title="Remover Formata√ß√£o">‚úï</div>
        </div>
        <button class="tool-btn" onclick="formatDoc('justifyLeft')" title="Alinhar √† Esquerda"><i class="fas fa-align-left"></i></button>
        <button class="tool-btn" onclick="formatDoc('justifyCenter')" title="Centralizar"><i class="fas fa-align-center"></i></button>
        <button class="tool-btn" onclick="formatDoc('justifyRight')" title="Alinhar √† Direita"><i class="fas fa-align-right"></i></button>
        <button class="tool-btn" onclick="formatDoc('insertUnorderedList')" title="Lista"><i class="fas fa-list-ul"></i></button>
    </div>
    <div class="modal-body" style="padding:0;">
        <div id="editorContent" contenteditable="true" spellcheck="false"></div>
    </div>
    <div class="modal-footer">
        <button class="btn-primary" onclick="saveCurrentNote()">Salvar Resumo</button>
    </div>
</div>

<!-- MODAL LISTA NOTAS -->
<div id="notesListModal" class="modal-window">
    <div class="modal-header">
        <div class="modal-title"><i class="fas fa-book" style="color: var(--primary)"></i> Meus Resumos</div>
        <button class="modal-close-btn" onclick="closeAllModals()"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body" id="notesListContainer"></div>
</div>

<!-- MODAL LEITURA -->
<div id="readNoteModal" class="modal-window">
    <div class="modal-header">
        <div class="modal-title"><i class="fas fa-file-alt" style="color: var(--text-light)"></i> <span id="readNoteTitle">Leitura</span></div>
        <button class="modal-close-btn" onclick="closeAllModals()"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body" style="background: var(--bg-color); padding: 20px;">
        <div id="readNoteContent" class="read-mode-content"></div>
    </div>
    <div class="modal-footer">
        <button class="btn-secondary" onclick="printElement('readNoteContent')"><i class="fas fa-print"></i> Imprimir</button>
        <button class="btn-primary" id="btnEditFromRead"><i class="fas fa-pen"></i> Editar Resumo</button>
    </div>
</div>

<!-- MODAL MANAGER -->
<div id="managerModal" class="modal-window">
    <div class="modal-header">
        <div class="modal-title"><i class="fas fa-cog" style="color: var(--primary)"></i> Gerenciar Cronograma</div>
        <button class="modal-close-btn" onclick="closeAllModals()"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body" id="managerBody"></div>
    <div class="modal-footer">
        <button class="btn-secondary" onclick="addWeekInManager()">+ Nova Semana</button>
        <button class="btn-primary" onclick="saveManagerChanges()">Salvar e Aplicar</button>
    </div>
</div>

<!-- NOVO: MODAL LEITOR PDF FLUTUANTE -->
<div id="pdfReaderModal">
    <div class="reader-header">
        <div class="reader-title"><i class="fas fa-book-reader"></i> Leitura de Material</div>
        <button class="reader-close" onclick="closePdfReader()">Fechar</button>
    </div>
    <div class="reader-body">
        <iframe id="pdfFrame" class="pdf-frame" src=""></iframe>
    </div>
</div>

<script>
    // --- BYPASS LOGIN: AUTOLOGIN ---
    const VALID_USER = "Henrique", VALID_PASS = "4441";
    let currentUser = "Henrique"; // Fixo para evitar login
    let activeTopicId = null; 
    let currentVideoTopicId = null;
    let currentVideoIndex = -1; 
    let currentVideoUrl = ""; 
    let activeContext = 'main'; 

    // --- EXECU√á√ÉO AUTOM√ÅTICA AO CARREGAR ---
    window.onload = function() {
        autoLogin();
    };

    function autoLogin() {
        currentUser = "Henrique";
        document.getElementById('loadingOverlay').style.display = 'flex';
        // Simula chamada de dados ou chama Google Script se existir
        if(typeof google === 'undefined') {
            setTimeout(() => onDataLoaded({}), 1000);
        } else {
            google.script.run.withSuccessHandler(onDataLoaded).loadAllData();
        }
    }
    
    // Fun√ß√£o mantida para compatibilidade, mas n√£o usada pelo UI
    function attemptLogin() { autoLogin(); }

    function onDataLoaded(serverDB) {
        try {
            document.getElementById('loadingOverlay').style.display = 'none';
            // Login screen div est√° oculta via CSS, garantindo que n√£o apare√ßa
            document.getElementById('mainContainer').style.opacity = "1";
            
            if(serverDB.progress) progressData = JSON.parse(serverDB.progress);
            if(serverDB.notes) notesData = JSON.parse(serverDB.notes);
            if(serverDB.simulados) simuladosData = JSON.parse(serverDB.simulados);
            if(serverDB.videos) videoData = JSON.parse(serverDB.videos);
            if(serverDB.pdfData) pdfData = JSON.parse(serverDB.pdfData);
            if(serverDB.comments) commentsData = JSON.parse(serverDB.comments);
            if(serverDB.syllabus) syllabusMain = JSON.parse(serverDB.syllabus);
            if(serverDB.syllabus_medcof) syllabusMedcof = JSON.parse(serverDB.syllabus_medcof);
            if(serverDB.meta) simuladosMeta = parseInt(serverDB.meta);

            sanitizeNotes();
            setGreeting();
            migrateVideoData();
            showWelcomeMessage(); 
            render(); 
        } catch(e) {
            console.error(e);
            document.getElementById('loadingOverlay').style.display = 'none';
            alert("Erro ao carregar dados: " + e.message);
        }
    }

    // --- RESTO DO C√ìDIGO ORIGINAL (INTACTO) ---
    function sanitizeNotes() {
        Object.keys(notesData).forEach(key => {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = notesData[key];
            const text = tempDiv.innerText.trim();
            const hasImg = tempDiv.querySelector('img');
            if (!text && !hasImg) delete notesData[key];
        });
        saveState();
    }
    
    function migrateVideoData() {
        for(let key in videoData) {
            if(typeof videoData[key] === 'string') videoData[key] = [{ title: 'Aula Principal', url: videoData[key] }];
        }
    }
    
    function logout() {
        if(confirm("Deseja recarregar o sistema?")) {
            location.reload(); 
        }
    }

    function showWelcomeMessage() {
        let nextTaskName = "Revis√£o Geral";
        let found = false;
        const currentSyllabus = getCurrentSyllabus();
        const prefix = getPrefix();

        currentSyllabus.forEach((week, wIndex) => {
            if(found) return;
            week.topics.forEach((topic, tIndex) => {
                if(found) return;
                const baseId = `${prefix}w${wIndex}_t${tIndex}`;
                if(!progressData[`${baseId}_aula`]) { 
                    nextTaskName = topic;
                    nextTaskGlobal = { weekIndex: wIndex, topicId: baseId }; 
                    found = true;
                }
            });
        });

        document.getElementById('welcomeTitle').innerText = `Seja bem vindo, Doutor ${currentUser}!`;
        document.getElementById('welcomeText').innerText = `Hoje temos que come√ßar no tema: "${nextTaskName}"... vamos concluir a meta de hoje.`;
        openModal('welcomeModal');
    }

    function goToNextTaskFromWelcome() {
        closeAllModals();
        goToNextTask();
    }

    function handleEnter(e) { if(e.key==='Enter') attemptLogin(); }
    function forgotPassword() { alert("Recupera√ß√£o n√£o necess√°ria no modo autom√°tico."); }

    // --- TIMERS ---
    let timerInterval, isTimerRunning=false, pomoTime=25*60, swTime=0;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playAlarm() {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.type = 'square';
        osc.frequency.setValueAtTime(440, audioCtx.currentTime); 
        osc.frequency.setValueAtTime(880, audioCtx.currentTime + 0.2); 
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.5);
        osc.start(); osc.stop(audioCtx.currentTime + 0.5);
    }

    function toggleTimerWidget() {
        const w = document.getElementById('timerWidget');
        w.classList.toggle('minimized');
        document.getElementById('timerToggleIcon').style.transform = w.classList.contains('minimized') ? "rotate(180deg)" : "rotate(0deg)";
    }
    function switchTimerTab(tab) {
        document.getElementById('tabPomodoro').classList.remove('active');
        document.getElementById('tabStopwatch').classList.remove('active');
        document.getElementById('bodyPomodoro').style.display='none';
        document.getElementById('bodyStopwatch').style.display='none';
        if(tab==='pomodoro') {
            document.getElementById('tabPomodoro').classList.add('active');
            document.getElementById('bodyPomodoro').style.display='block';
            document.getElementById('timerTitle').innerHTML='<i class="fas fa-hourglass-half"></i> Pomodoro';
        } else {
            document.getElementById('tabStopwatch').classList.add('active');
            document.getElementById('bodyStopwatch').style.display='block';
            document.getElementById('timerTitle').innerHTML='<i class="fas fa-stopwatch"></i> Cron√¥metro';
        }
        if(isTimerRunning) { clearInterval(timerInterval); isTimerRunning=false; updateTimerButtons(); }
    }
    function formatTime(s) { return `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`; }
    function formatSwTime(s) { return `${Math.floor(s/3600).toString().padStart(2,'0')}:${Math.floor((s%3600)/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`; }
    function startPomodoro() {
        if(isTimerRunning) { clearInterval(timerInterval); isTimerRunning=false; }
        else {
            if(pomoTime<=0) resetPomodoro();
            isTimerRunning=true;
            timerInterval = setInterval(()=>{
                pomoTime--;
                document.getElementById('pomoDisplay').innerText = formatTime(pomoTime);
                if(pomoTime<=0) { 
                    clearInterval(timerInterval); 
                    isTimerRunning=false; 
                    playAlarm(); 
                    setTimeout(()=>alert("Tempo esgotado!"), 100);
                    updateTimerButtons(); 
                }
            },1000);
        }
        updateTimerButtons();
    }
    function resetPomodoro() {
        clearInterval(timerInterval); isTimerRunning=false;
        pomoTime = document.getElementById('pomoInput').value * 60;
        document.getElementById('pomoDisplay').innerText = formatTime(pomoTime);
        updateTimerButtons();
    }
    function startStopwatch() {
        if(isTimerRunning) { clearInterval(timerInterval); isTimerRunning=false; }
        else {
            isTimerRunning=true;
            timerInterval = setInterval(()=>{ swTime++; document.getElementById('swDisplay').innerText = formatSwTime(swTime); },1000);
        }
        updateTimerButtons();
    }
    function resetStopwatch() {
        clearInterval(timerInterval); isTimerRunning=false; swTime=0;
        document.getElementById('swDisplay').innerText = formatSwTime(swTime);
        updateTimerButtons();
    }
    function updateTimerButtons() {
        const bp = document.getElementById('btnStartPomo'), bs = document.getElementById('btnStartSw');
        if(document.getElementById('bodyPomodoro').style.display!=='none') {
            bp.innerText = isTimerRunning ? "Pausar" : "Iniciar";
            bp.className = isTimerRunning ? "btn-timer btn-stop" : "btn-timer btn-start";
        } else {
            bs.innerText = isTimerRunning ? "Pausar" : "Iniciar";
            bs.className = isTimerRunning ? "btn-timer btn-stop" : "btn-timer btn-start";
        }
    }

    // --- THEME ---
    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        localStorage.setItem('med_pro_theme', isDark?'dark':'light');
        updateThemeIcon(isDark);
    }
    function updateThemeIcon(isDark) {
        const i = document.getElementById('themeIcon');
        i.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
    }
    if(localStorage.getItem('med_pro_theme')==='dark') document.body.classList.add('dark-mode');

    // --- DATA ---
    const DEFAULT_SYLLABUS = [
        { title: "Semana 1", topics: ["3.1 Imuniza√ß√µes", "3.2 Trauma - Avalia√ß√£o Inicial", "3.3 Trauma Tor√°cico", "3.4 Marcos Legais do SUS", "3.5 Ciclo Menstrual", "3.6 Assist√™ncia ao Pr√©-Natal", "3.7 Tuberculose", "3.8 Aleitamento Materno", "3.9 Princ√≠pios do SUS", "3.10 Miomatose Uterina", "3.11 Introdu√ß√£o Diabetes", "3.12 DRGE", "3.13 Depend√™ncia Qu√≠mica", "3.14 Leptospirose e Mal√°ria", "3.15 Hipertens√£o Arterial", "3.16 Simulado de Revis√£o"] },
        { title: "Semana 2", topics: ["4.1 Puberdade", "4.2 Trauma - Choque", "4.3 Descentraliza√ß√£o SUS", "4.4 Partograma e Distocia", "4.5 Diagn√≥stico Nutricional", "4.6 Trauma Abdominal", "4.7 C√¢ncer Endom√©trio", "4.8 Neutropenia Febril", "4.9 Diabetes Tipo II", "4.10 √ölcera P√©ptica", "4.11 Transtornos do Humor", "4.12 Hipertens√£o Secund√°ria", "4.13 Derrame Pleural", "4.14 Doen√ßa Renal Cr√¥nica", "4.15 Simulado de Revis√£o"] },
        { title: "Semana 3", topics: ["5.1 DNPM", "5.2 Queimaduras", "5.3 PNAB", "5.4 Viol√™ncia Sexual", "5.5 Assist√™ncia ao Parto", "5.6 Icter√≠cia Neonatal", "5.7 Apendicite e Diverticulite", "5.8 Med. Fam√≠lia", "5.9 Sangramento Uterino", "5.10 HIV", "5.11 Insulinoterapia", "5.12 Pancreatite", "5.13 Ansiedade", "5.14 Insufici√™ncia Card√≠aca", "5.15 Anemias Carenciais", "5.16 Simulado de Revis√£o"] },
        { title: "Semana 4", topics: ["6.1 Reanima√ß√£o Neonatal", "6.2 Abdome Perfurativo", "6.3 √âtica M√©dica", "6.4 Amenorreia", "6.5 Sangramento 1¬™ Metade", "6.6 Arboviroses", "6.7 Cetoacidose Diab√©tica", "6.8 SOP", "6.9 Disabsor√ß√£o", "6.10 Psicose", "6.11 Coronariopatia", "6.12 DPOC", "6.13 LRA e Hipercalemia", "6.14 Hepatites", "6.15 Coma e TCE", "6.16 Simulado de Revis√£o"] },
        { title: "Semana 5", topics: ["7.1 Infec√ß√µes Cong√™nitas", "7.2 Abdome Obstrutivo", "7.3 Sa√∫de-Doen√ßa", "7.4 Planejamento Familiar", "7.5 Hemorragia P√≥s-Parto", "7.6 Pneumonia Inf√¢ncia", "7.7 Complica√ß√µes P√≥s-Op", "7.8 Climat√©rio", "7.9 PAC e Sepse", "7.10 Tireoide Avalia√ß√£o", "7.11 DII", "7.12 Intoxica√ß√µes", "7.13 Valvopatias", "7.14 Anemias Hemol√≠ticas", "7.15 Artrites", "7.16 Simulado de Revis√£o"] },
        { title: "Semana 6", topics: ["8.1 Bronquiolite", "8.2 Ferimentos", "8.3 Medidas de Sa√∫de Coletiva", "8.4 Infertilidade Conjugal", "8.5 Trabalho de Parto Prematuro", "8.6 Animais Pe√ßonhentos", "8.7 Tireoide - Hipotireoidismo", "8.8 DIP e Cervicites", "8.9 HDA", "8.10 Psiquiatria Infantil", "8.11 Arritmias", "8.12 TEP", "8.13 ITU e Lit√≠ase", "8.14 Cirrose", "8.15 AVC e Cefaleias", "8.16 Faringites", "8.17 Simulado de Revis√£o"] },
        { title: "Semana 7", topics: ["9.1 Asma em Pediatria", "9.2 H√©rnias Inguinais", "9.3 Processos Epid√™micos", "9.4 √ölceras Genitais", "9.5 S√≠ndromes Hipertensivas Gesta√ß√£o", "9.6 Doen√ßas Exantem√°ticas", "9.7 Ves√≠cula Biliar", "9.8 Vulvovaginites", "9.9 Meningites", "9.10 Tireoide - Tireotoxicose", "9.11 HDB", "9.12 Transtornos Alimentares", "9.13 Onco-Hematologia", "9.14 Doen√ßas Autoimunes (LES, SAF)", "9.15 Hansen√≠ase", "9.16 Otite M√©dia Aguda", "9.17 Simulado de Revis√£o"] },
        { title: "Semana 8", topics: ["10.1 Tuberculose Inf√¢ncia", "10.2 Proctologia", "10.3 Vigil√¢ncia em Sa√∫de", "10.4 Rastreamento Ca Colo Uterino", "10.5 Diabetes na Gesta√ß√£o", "10.6 Parasitoses", "10.7 Tireoide - N√≥dulos e Ca", "10.8 C√¢ncer de Colo Uterino", "10.9 C√¢ncer G√°strico", "10.10 Psicofarmacologia", "10.11 Asma", "10.12 Dist√∫rbios √Åcido-Base", "10.13 Ascite", "10.14 Parkinson e Dem√™ncias", "10.15 Corpo Estranho Ouvido", "10.16 Conjuntivites", "10.17 Simulado de Revis√£o"] },
        { title: "Semana 9", topics: ["11.1 Doen√ßa Diarreica", "11.2 Cirurgia Pedi√°trica", "11.3 Declara√ß√£o de √ìbito", "11.4 Tumores Anexiais", "11.5 Vitalidade Fetal / RCF", "11.6 ITU", "11.7 Cirurgia Vascular", "11.8 Doen√ßas Benignas da Mama", "11.9 Covid-19", "11.10 Obesidade e SM", "11.11 C√¢ncer Colorretal", "11.12 Neoplasias Pulmonares", "11.13 Hemostasia", "11.14 C√¢ncer de Pele", "11.15 Rinossinusites", "11.16 Uve√≠te Anterior", "11.17 Simulado de Revis√£o"] },
        { title: "Semana 10", topics: ["12.1 Febre Reum√°tica", "12.2 Urologia", "12.3 Sa√∫de do Trabalhador", "12.4 Rastreamento Ca Mama", "12.5 Infec√ß√µes Cong√™nitas", "12.6 S√≠filis", "12.7 Osteoporose", "12.8 C√¢ncer de Mama", "12.9 Pneumoconioses", "12.10 Doen√ßas Glomerulares", "12.11 Tumores Hep√°ticos", "12.12 Epistaxe", "12.13 Glaucoma Agudo", "12.14 Ortopedia", "12.15 Trauma Ocular", "12.16 Simulado de Revis√£o"] }
    ];

    const DEFAULT_SYLLABUS_MEDCOF = [
        { 
            title: "Bloco 1", 
            topics: [
                "[Onboarding] Comece por aqui: personalizando seu QBank",
                "[Onboarding] Plataforma de aulas",
                "[Onboarding] Diferen√ßa entre cofexpress e aula de aprofundamento",
                "[Onboarding] DailyCof - Tudo o que voc√™ precisa saber",
                "[Onboarding] CofBot - A intelig√™ncia artificial que realmente te ajuda",
                "[Onboarding] Diferen√ßa entre tarefa m√≠nima e tarefa b√¥nus",
                "[Onboarding] Material de Apoio - Fichas-resumo",
                "[Onboarding] Material de Apoio - Flashcards",
                "[Onboarding] Execu√ß√£o de testes - Criando novo teste",
                "[Onboarding] Estat√≠sticas",
                "[Onboarding] Demais fun√ß√µes Qbank",
                "[Onboarding] Guia Estat√≠stico",
                "[Onboarding] Revis√£o N√∫cleo - O que √©, como e onde?",
                "[Onboarding] Provas na √çntegra - Onde e como fazer?",
                "[Onboarding] Sobre a Comunidade",
                "[Onboarding] Colocando Tudo Isso em Ordem - Sugest√µes de Uma Rotina de Estudo",
                "[Cl√≠nica M√©dica] Avalia√ß√£o Global do Hemograma",
                "[Cl√≠nica M√©dica] Anemias Hipoproliferativas I",
                "[Cl√≠nica M√©dica] Anemias Hipoproliferativas II",
                "[GO] Modifica√ß√µes do Organismo Materno",
                "[GO] Assist√™ncia ao Pr√©-Natal",
                "[GO] Ultrassonografia em Obstetr√≠cia",
                "[Pediatria] Aleitamento Materno",
                "[Pediatria] Alimenta√ß√£o Infantil",
                "[Pediatria] Desenvolvimento Infantil",
                "[Pediatria] Altera√ß√µes no Neurodesenvolvimento - TEA e TDAH",
                "[Preventiva] Boas Vindas √† Preventiva",
                "[Preventiva] N√≠veis de Preven√ß√£o",
                "[Preventiva] Indicadores de Sa√∫de",
                "[Cirurgia] Introdu√ß√£o ao Extensivo e Como Acertar Quest√µes de Prova",
                "[Cirurgia] Introdu√ß√£o ao Trauma e Atendimento Inicial",
                "[Cirurgia] Trauma: Vias A√©reas",
                "[Cirurgia] Choque e Ressuscita√ß√£o Hemost√°tica"
            ] 
        },
        { 
            title: "Bloco 2", 
            topics: [
                "[Cl√≠nica M√©dica] Neurovascular I: AIT e AVCi",
                "[Cl√≠nica M√©dica] Neurovascular II: HSA e AVCh",
                "[GO] Anatomia P√©lvica Feminina",
                "[GO] Embriologia do Sistema Genital Feminino",
                "[GO] Malforma√ß√µes Mullerianas",
                "[Pediatria] Febre sem Sinais Localizat√≥rios",
                "[Pediatria] Nefrologia Pedi√°trica",
                "[Pediatria] Doen√ßa Renal Cr√¥nica e Les√£o Renal Aguda",
                "[Pediatria] Miscel√¢nea em Nefropediatria",
                "[Preventiva] Testes Diagn√≥sticos",
                "[Preventiva] Assist√™ncia ao Pr√©-Natal na APS",
                "[Cirurgia] Trauma: Medidas Auxiliares, FAST e demais avalia√ß√µes",
                "[Cirurgia] Trauma: Popula√ß√µes especiais",
                "[Cirurgia] Trauma de T√≥rax"
            ] 
        },
        { 
            title: "Bloco 3", 
            topics: [
                "[Cl√≠nica M√©dica] S√≠filis",
                "[Cl√≠nica M√©dica] Dispepsia, DRGE e Barret",
                "[Cl√≠nica M√©dica] √ölcera p√©ptica, H. pylori, Gastrite Atr√≥fica e Dispepsia Funcional",
                "[GO] Corrimentos Vaginais",
                "[GO] Doen√ßa Inflamat√≥ria P√©lvica Aguda",
                "[GO] √ölceras Genitais",
                "[Pediatria] Alergia Alimentar, Refluxo e Constipa√ß√£o",
                "[Pediatria] Diarreia Cr√¥nica e Doen√ßas Funcionais",
                "[Pediatria] Viol√™ncia Contra a Crian√ßa e o Adolescente",
                "[Preventiva] Determina√ß√£o Social do Processo Sa√∫de-Doen√ßa e Promo√ß√£o de Sa√∫de",
                "[Cirurgia] Trauma Abdominal",
                "[Cirurgia] Trauma Urol√≥gico"
            ] 
        },
        { 
            title: "Bloco 4", 
            topics: [
                "[Cl√≠nica M√©dica] Introdu√ß√£o √†s Artrites e Artrite Reumatoide (AR)",
                "[Cl√≠nica M√©dica] Espondiloartrites",
                "[Cl√≠nica M√©dica] Artrites Microcristalinas (Gota e CPPD)",
                "[Cl√≠nica M√©dica] Osteoartrite",
                "[Cl√≠nica M√©dica] Fibromialgia",
                "[GO] Assist√™ncia ao Parto",
                "[GO] Sofrimento Fetal Agudo",
                "[Pediatria] Crescimento e Baixa Estatura",
                "[Pediatria] Obesidade e S√≠ndrome Metab√≥lica",
                "[Pediatria] Puberdade",
                "[Pediatria] Desnutri√ß√£o e Vitaminas",
                "[Preventiva] Redes de Aten√ß√£o √† Sa√∫de e N√≠veis de Aten√ß√£o",
                "[Preventiva] Aten√ß√£o Prim√°ria √† Sa√∫de",
                "[Cirurgia] Trauma de Pelve",
                "[Cirurgia] Trauma Cranioencef√°lico",
                "[Cirurgia] Trauma Raquimedular",
                "[Cirurgia] Trauma Musculoesquel√©tico",
                "[Cirurgia] Trauma de Pesco√ßo"
            ] 
        },
        { 
            title: "Bloco 5", 
            topics: [
                "[Cl√≠nica M√©dica] Dor Tor√°cica Coronariana",
                "[Cl√≠nica M√©dica] Dor Tor√°cica N√£o Coronariana",
                "[GO] Fisiologia Menstrual",
                "[GO] Amenorreia Prim√°ria",
                "[GO] Esteroidog√™nese",
                "[Pediatria] Politrauma, Afogamento",
                "[Pediatria] Queimaduras",
                "[Pediatria] Traumatismo Cranioentecef√°lico e Hipertens√£o Intracraniana",
                "[Pediatria] Diarreia Aguda",
                "[Preventiva] Classifica√ß√£o dos Estudos Epidemiol√≥gicos",
                "[Preventiva] Associa√ß√£o x Causalidade",
                "[Preventiva] Rastreamentos",
                "[Cirurgia] Trauma: Encerramento",
                "[Cirurgia] Queimaduras",
                "[Cirurgia] Escroto Agudo",
                "[Cirurgia] Priapismo"
            ] 
        },
        { 
            title: "Bloco 6", 
            topics: [
                "[Cl√≠nica M√©dica] Gasometria Arterial",
                "[Cl√≠nica M√©dica] Dist√∫rbios do S√≥dio",
                "[Cl√≠nica M√©dica] Dist√∫rbios do Pot√°ssio",
                "[Cl√≠nica M√©dica] Rea√ß√µes Al√©rgicas",
                "[GO] Amenorreia Secund√°ria",
                "[GO] Hiperprolactinemia",
                "[GO] S√≠ndrome dos Ov√°rios Polic√≠sticos",
                "[Pediatria] Infec√ß√µes de Vias A√©reas Superiores (IVAS)",
                "[Pediatria] Autoinflamat√≥rias",
                "[Pediatria] Pneumonias",
                "[Pediatria] Bronquiolite e Coqueluche",
                "[Pediatria] COVID",
                "[Preventiva] Estudos Transversais",
                "[Preventiva] Estudos Longitudinais: Coorte e Caso-Controle",
                "[Cirurgia] Abdome Agudo: Introdu√ß√£o",
                "[Cirurgia] Apendicite Aguda",
                "[Cirurgia] Cicatriza√ß√£o e Les√µes por Press√£o",
                "[Cirurgia] Fios de Sutura",
                "[Cirurgia] Anest√©sicos Locais"
            ] 
        },
        { 
            title: "Bloco 7", 
            topics: [
                "[Cl√≠nica M√©dica] Antibi√≥ticos",
                "[Cl√≠nica M√©dica] Anemias Hemol√≠ticas",
                "[Cl√≠nica M√©dica] Oncologia: emerg√™ncias e cuidados paliativos",
                "[GO] Infec√ß√µes e Gravidez",
                "[GO] Rotura Prematura de Membranas Ovulares",
                "[GO] Viol√™ncia Sexual",
                "[GO] Interrup√ß√£o Legal da Gesta√ß√£o",
                "[Pediatria] Reanima√ß√£o Neonatal",
                "[Pediatria] Infec√ß√µes Cong√™nitas",
                "[Pediatria] Icter√≠cia e Colestase Neonatal",
                "[Preventiva] Hist√≥ria e Princ√≠pios do SUS",
                "[Cirurgia] Urg√™ncias da Ves√≠cula Biliar",
                "[Cirurgia] C√¢ncer de Es√¥fago"
            ] 
        },
        { 
            title: "Bloco 8", 
            topics: [
                "[Cl√≠nica M√©dica] Cefaleias",
                "[Cl√≠nica M√©dica] Avalia√ß√£o Geri√°trica Ampla",
                "[Cl√≠nica M√©dica] Grandes S√≠ndromes Geri√°tricas",
                "[Cl√≠nica M√©dica] Avalia√ß√£o de enzimas hep√°ticas",
                "[Cl√≠nica M√©dica] Doen√ßas hep√°ticas: CBP, CEP, HAI e Doen√ßa de Wilson",
                "[GO] Abortamento",
                "[GO] Gesta√ß√£o Ect√≥pica",
                "[GO] Doen√ßa Trofobl√°stica Gestacional",
                "[Pediatria] Dermatite At√≥pica e Les√µes Benignas do Rec√©m-Nascido",
                "[Pediatria] Dermatoses e Infec√ß√µes de Partes Moles",
                "[Preventiva] Legisla√ß√£o do SUS I: Leis Org√¢nicas da Sa√∫de",
                "[Cirurgia] Pancreatite Aguda",
                "[Cirurgia] Diverticulite Aguda",
                "[Cirurgia] Abscesso Hep√°tico",
                "[Cirurgia] Disfagia e Acalasia",
                "[Cirurgia] Hernias de Hiato"
            ] 
        },
        { 
            title: "Bloco 9", 
            topics: [
                "[Cl√≠nica M√©dica] Coagula√ß√£o e Hemostasia",
                "[Cl√≠nica M√©dica] Hemoterapia",
                "[Cl√≠nica M√©dica] Cirrose Hep√°tica I",
                "[Cl√≠nica M√©dica] Cirrose Hep√°tica II",
                "[Cl√≠nica M√©dica] Pneumonia: Adquirida na Comunidade",
                "[Cl√≠nica M√©dica] Derrame Pleural",
                "[GO] Placenta Pr√©via",
                "[GO] Descolamento Prematuro de Placenta",
                "[GO] Outros Sangramentos de Segunda Metade da Gesta√ß√£o",
                "[Pediatria] Anemia Falciforme",
                "[Pediatria] Anemia Ferropriva e Talassemia",
                "[Pediatria] Hemostasia e Dist√∫rbios Hemorr√°gicos",
                "[Pediatria] Gen√©tica",
                "[Preventiva] Legisla√ß√£o do SUS II: NOBs, NOAS e Pacto pela Sa√∫de",
                "[Preventiva] Tabagismo",
                "[Cirurgia] Abdome Agudo Obstrutivo",
                "[Cirurgia] Abdome Agudo Perfurativo, Vascular e Hemorr√°gico",
                "[Cirurgia] C√¢ncer de Est√¥mago"
            ] 
        },
        { 
            title: "Bloco 10", 
            topics: [
                "[Cl√≠nica M√©dica] HAS : Ambulatorial e Emerg√™ncias",
                "[Cl√≠nica M√©dica] Insufici√™ncia Card√≠aca",
                "[Cl√≠nica M√©dica] Espirometria e Asma",
                "[Cl√≠nica M√©dica] Doen√ßa Pulmonar Obstrutiva Cr√¥nica (DPOC)",
                "[Cl√≠nica M√©dica] BLS e ACLS",
                "[GO] S√≠ndromes Hipertensivas na Gesta√ß√£o",
                "[GO] Sangramento Uterino Anormal",
                "[Pediatria] Suporte Avan√ßado de Vida em Pediatria (PALS)",
                "[Pediatria] Cardiopatias Cong√™nitas",
                "[Pediatria] Hipertens√£o Arterial Sist√™mica (HAS)",
                "[Pediatria] Miocardite, S√≠ncope, Insufici√™ncia Card√≠aca",
                "[Preventiva] Medidas de Associa√ß√£o - Exerc√≠cios",
                "[Preventiva] Legisla√ß√£o do SUS 3: Decreto 7508/11",
                "[Preventiva] Rede de Aten√ß√£o Psicossocial (RAPS)",
                "[Cirurgia] Anatomia da Parede Abdominal e H√©rnia Inguinal",
                "[Cirurgia] Hernioplastia Inguinal",
                "[Cirurgia] Outras Neoplasias G√°stricas",
                "[Cirurgia] Enxertos e Retalhos"
            ] 
        },
        { 
            title: "Bloco 11", 
            topics: [
                "[Cl√≠nica M√©dica] Diabetes: Classifica√ß√£o, Diagn√≥stico e Meta Terap√™utica",
                "[Cl√≠nica M√©dica] Diabetes: Tratamento",
                "[Cl√≠nica M√©dica] Emerg√™ncias Hiperglic√™micas (CAD e EHH)",
                "[Cl√≠nica M√©dica] Hiperglicemia Hospitalar",
                "[GO] Diabetes na Gesta√ß√£o",
                "[GO] Infertilidade",
                "[GO] Endometriose",
                "[Pediatria] Arboviroses",
                "[Pediatria] Doen√ßas Exantem√°ticas",
                "[Pediatria] Cetoacidose Diab√©tica (CAD)",
                "[Preventiva] Financiamento do SUS e Planejamento em Sa√∫de",
                "[Preventiva] Ensaios Cl√≠nicos",
                "[Preventiva] √âtica em Pesquisa Cl√≠nica",
                "[Cirurgia] S√≠ndrome Compartimental Intra-Abdominal",
                "[Cirurgia] H√©rnias Incisionais e Fechamento de Parede",
                "[Cirurgia] Outras H√©rnias",
                "[Cirurgia] Urg√™ncias endosc√≥picas",
                "[Cirurgia] C√¢ncer de Est√¥mago"
            ] 
        },
        { 
            title: "Bloco 12", 
            topics: [
                "[Cl√≠nica M√©dica] S√≠ndrome Metab√≥lica e Obesidade",
                "[Cl√≠nica M√©dica] Dislipidemias",
                "[Cl√≠nica M√©dica] Doen√ßa Hep√°tica Esteat√≥tica Metab√≥lica (DHEM)",
                "[GO] Proped√™utica em Uroginecologia",
                "[GO] Incontin√™ncia Urin√°ria",
                "[GO] Prolapso Genital",
                "[Pediatria] Triagens Neonatais",
                "[Pediatria] Dist√∫rbios Metab√≥licos Neonatais",
                "[Pediatria] Pe√ßonhentos, Raiva e T√©tano",
                "[Pediatria] Ingest√£o e Aspira√ß√£o de Corpo Estranho e BRUE",
                "[Preventiva] Preventiva: a Jornada Continua",
                "[Preventiva] Signific√¢ncia Estat√≠stica: Valor-p e Intervalo de Confian√ßa",
                "[Preventiva] Revis√£o Sistem√°tica e Metan√°lise",
                "[Preventiva] Medicina Baseada em Evid√™ncias",
                "[Cirurgia] Pr√©-Operat√≥rio",
                "[Cirurgia] Uro-Oncologia",
                "[Cirurgia] Cirurgia Bari√°trica"
            ] 
        },
        { 
            title: "Bloco 13", 
            topics: [
                "[Cl√≠nica M√©dica] Vasculites",
                "[Cl√≠nica M√©dica] Tuberculose: cl√≠nica e diagn√≥stico",
                "[Cl√≠nica M√©dica] Tuberculose: tratamento",
                "[GO] Avalia√ß√£o de Vitalidade Fetal",
                "[GO] Restri√ß√£o de Crescimento Intrauterino",
                "[Preventiva] Cardiologia na APS",
                "[GO] Sofrimento Fetal Cr√¥nico",
                "[GO] Gemelaridade",
                "[Pediatria] Convuls√£o na Emerg√™ncia e Convuls√£o Febril",
                "[Pediatria] Tuberculose",
                "[Pediatria] Pediatria Geral",
                "[Preventiva] Diabetes no SUS",
                "[Preventiva] Estrat√©gia da Sa√∫de da Fam√≠lia",
                "[Cirurgia] REMIT e p√≥s-operat√≥rio",
                "[Cirurgia] Perioperat√≥rio: Complica√ß√µes gerais",
                "[Cirurgia] Fraturas de face",
                "[Cirurgia] Paralisia facial",
                "[Cirurgia] Hiperplasia prost√°tica benigna",
                "[Cirurgia] Cirurgia Geral: Respiro e pr√≥ximos passos"
            ] 
        },
        { 
            title: "Bloco 14", 
            topics: [
                "[Cl√≠nica M√©dica] Meningites & Encefalites",
                "[Cl√≠nica M√©dica] Doen√ßas Neuromusculares e Parkinson",
                "[Cl√≠nica M√©dica] Taquiarritmias - Cardiologia",
                "[Cl√≠nica M√©dica] Bradiarritimias",
                "[Cl√≠nica M√©dica] S√≠ncope",
                "[Cl√≠nica M√©dica] Doen√ßas Valvares",
                "[GO] Cardiopatias na Gravidez",
                "[GO] Anticoncep√ß√£o",
                "[Pediatria] Kawasaki, Vasculite por Iga e Febre Reum√°tica",
                "[Pediatria] Artrite Idiop√°tica Juvenil",
                "[Pediatria] Meningite e Encefalite",
                "[Preventiva] Financiamento da APS",
                "[Preventiva] S√≠ndrome Depressiva",
                "[Preventiva] S√≠ndrome Man√≠aca",
                "[Cirurgia] C√¢ncer Colorretal e S√≠ndromes Associadas",
                "[Cirurgia] Doen√ßas Orificiais e CEC de Canal Anal",
                "[Cirurgia] Doen√ßas da Ves√≠cula Biliar"
            ] 
        },
        { 
            title: "Bloco 15", 
            topics: [
                "[Cl√≠nica M√©dica] Via a√©rea, intuba√ß√£o e Ventila√ß√£o N√£o Invasiva (VNI)",
                "[Cl√≠nica M√©dica] S√≠ndrome do Desconforto Respirat√≥rio Agudo (SDRA)",
                "[Cl√≠nica M√©dica] Ventila√ß√£o Mec√¢nica",
                "[Cl√≠nica M√©dica] Infec√ß√µes Nosocomiais",
                "[Cl√≠nica M√©dica] Choque",
                "[Cl√≠nica M√©dica] Drogas Vasoativas e Sedoanalgesia",
                "[Cl√≠nica M√©dica] Vacina√ß√£o",
                "[GO] Proped√™utica Mam√°ria",
                "[GO] Principais Sintomas em Mastologia",
                "[GO] Classifica√ß√£o das Les√µes Benignas",
                "[Pediatria] Vacina√ß√£o",
                "[Pediatria] HIV",
                "[Pediatria] Ortopedia Pedi√°trica",
                "[Pediatria] Osteomielite e Artrite S√©ptica",
                "[Preventiva] Ferramentas da APS/ESF",
                "[Preventiva] S√≠ndrome Ansiosa",
                "[Cirurgia] F√≠gado para perdidos",
                "[Cirurgia] N√≥dulos hep√°ticos benignos",
                "[Cirurgia] Ferimento descolante"
            ] 
        },
        { 
            title: "Bloco 16", 
            topics: [
                "[Cl√≠nica M√©dica] Inj√∫ria Renal",
                "[Cl√≠nica M√©dica] Diarreia Agudas e Colite Pseudomembranosa",
                "[Cl√≠nica M√©dica] Diarreias Cr√¥nicas",
                "[Cl√≠nica M√©dica] Doen√ßa Inflamat√≥ria Intestinal (DII)",
                "[Cl√≠nica M√©dica] Doen√ßas Negligenciadas",
                "[GO] Trabalho de Parto Prematuro",
                "[GO] Colo Curto e Incompet√™ncia Istmocervical",
                "[Pediatria] Hiperplasia Adrenal Cong√™nita (HAC)",
                "[Pediatria] Hipotireoidismo",
                "[Pediatria] Diferen√ßas no Desenvolvimento Sexual",
                "[Pediatria] Nutrologia em Pediatria",
                "[Preventiva] Telessa√∫de e Publicidade M√©dica",
                "[Preventiva] M√©todo Cl√≠nico Centrado na Pessoa e Comunica√ß√£o de Not√≠cias Dif√≠ceis",
                "[Cirurgia] Lit√≠ase Renal: Pronto-Socorro e Tratamento Cir√∫rgico",
                "[Cirurgia] Carcinoma hepatocelular",
                "[Cirurgia] Aneurisma de Aorta"
            ] 
        },
        { 
            title: "Bloco 17", 
            topics: [
                "[Cl√≠nica M√©dica] L√∫pus Eritematoso Sist√™mico",
                "[Cl√≠nica M√©dica] Osteoporose",
                "[Cl√≠nica M√©dica] Esclerose Sist√™mica",
                "[Cl√≠nica M√©dica] Doen√ßa de Sj√∂gren",
                "[Cl√≠nica M√©dica] Miopatias Autoimunes Sist√™micas",
                "[Cl√≠nica M√©dica] Glomerulopatias",
                "[Cl√≠nica M√©dica] Intoxica√ß√µes Ex√≥genas",
                "[GO] Hemorragia p√≥s parto",
                "[GO] Puerp√©rio",
                "[Pediatria] Asma",
                "[Pediatria] Fibrose C√≠stica e Diferenciais",
                "[Pediatria] Imunodefici√™ncias para o Pediatra",
                "[Preventiva] Vigil√¢ncia em Sa√∫de",
                "[Preventiva] Registro de Sa√∫de Orientado por Problemas (ReSOAP)",
                "[Cirurgia] Met√°stases hep√°ticas de c√¢ncer colorretal",
                "[Cirurgia] Adenocarcinoma de p√¢ncreas e tumores periampulares",
                "[Cirurgia] F√≠gado e VB: Quiz"
            ] 
        },
        { 
            title: "Bloco 18", 
            topics: [
                "[Cl√≠nica M√©dica] HIV e Doen√ßas Oportunistas",
                "[Cl√≠nica M√©dica] Fisiologia da Tireoide e Hipotireoidismo",
                "[Cl√≠nica M√©dica] Hipertireoidismo e Tireoidite",
                "[Cl√≠nica M√©dica] Epilepsia",
                "[Cl√≠nica M√©dica] Esclerose M√∫ltipla (EM) e Neuromielite √≥ptica",
                "[Cl√≠nica M√©dica] Neuromielite √ìptica (NMO)",
                "[Cl√≠nica M√©dica] Esclerose M√∫ltipla (EM)",
                "[GO] C√¢ncer de Colo de √ötero - Rastreamento",
                "[GO] C√¢ncer de Colo de √ötero - Diagn√≥stico e Tratamento",
                "[GO] Doen√ßas da Vulva e da Vagina",
                "[Pediatria] Sepse Neonatal",
                "[Pediatria] Desconforto Respirat√≥rio Neonatal",
                "[Pediatria] Outras Doen√ßas Neonatais",
                "[Pediatria] Nutri√ß√£o do Pr√©-Termo",
                "[Preventiva] Processo Epid√™mico",
                "[Preventiva] Abordagem Familiar e Comunit√°ria",
                "[Cirurgia] S√≠ndrome de Fournier",
                "[Cirurgia] Ortopedia",
                "[Cirurgia] Trombose venosa profunda",
                "[Cirurgia] Cirurgia Tor√°cica: Pneumot√≥rax"
            ] 
        },
        { 
            title: "Bloco 19", 
            topics: [
                "[Cl√≠nica M√©dica] Tromboembolismo Pulmonar",
                "[Cl√≠nica M√©dica] Dist√∫rbios do Sono",
                "[Cl√≠nica M√©dica] Doen√ßa Pulmonar Intersticial (DPI)",
                "[Cl√≠nica M√©dica] N√≥dulo Pulmonar",
                "[Cl√≠nica M√©dica] Adrenal",
                "[Cl√≠nica M√©dica] S√≠ndrome de Cushing",
                "[Cl√≠nica M√©dica] Disfagia, Esofagite Eosinof√≠lica e Acalasias",
                "[GO] C√¢ncer de Mama - Rastreamento",
                "[GO] C√¢ncer de Mama - Fatores de Risco e CDIS",
                "[GO] C√¢ncer de Mama - Doen√ßa Invasiva",
                "[Pediatria] Parasitoses Intestinais",
                "[Pediatria] Neoplasias Pedi√°tricas",
                "[Preventiva] Acidente de Trabalho",
                "[Preventiva] S√≠ndrome Psic√≥tica",
                "[Preventiva] Psicofarmacologia",
                "[Cirurgia] Oncocirurgia Geral",
                "[Cirurgia] Isquemia de membros inferiores"
            ] 
        },
        { 
            title: "Bloco 20", 
            topics: [
                "[Cl√≠nica M√©dica] Infec√ß√£o do Trato Urin√°rio (ITU)",
                "[Cl√≠nica M√©dica] Outro Dist√∫rbios Hidroeletrol√≥iticos (C√°lcio, F√≥sforo e Magn√©sio)",
                "[Cl√≠nica M√©dica] Doen√ßa Renal Cr√¥nica",
                "[GO] S√≠ndrome Climat√©rica",
                "[GO] Terapia Hormonal",
                "[GO] Tumores Anexiais",
                "[GO] C√¢ncer de Ov√°rio",
                "[Pediatria] Infec√ß√£o de Trato Urin√°rio (ITU)",
                "[Pediatria] Sedoanalgesia e Sequ√™ncia R√°pida de Intuba√ß√£o",
                "[Pediatria] Sepse Pedi√°trica",
                "[Pediatria] Choque e Drogas Vasoativas",
                "[Preventiva] Pneumoconioses",
                "[Preventiva] Tuberculose e Hansen√≠ase na APS",
                "[Preventiva] Sa√∫de Socioecol√≥gica",
                "[Cirurgia] Cirurgia: Resum√£o/Encerramento",
                "[Cirurgia] Neoplasias C√≠sticas Pancre√°ticas",
                "[Cirurgia] Pancreatite Cr√¥nica",
                "[Cirurgia] Trauma Vascular",
                "[Cirurgia] Estenose Carot√≠dea",
                "[Cirurgia] Cancer de Pulm√£o"
            ] 
        },
        { 
            title: "Bloco 21", 
            topics: [
                "[Cl√≠nica M√©dica] Depress√£o e Delirium no Idoso",
                "[Cl√≠nica M√©dica] Insufici√™ncia Cognitiva: Dem√™ncias",
                "[GO] Hiperplasia Endometrial",
                "[GO] C√¢ncer de Endom√©trio",
                "[GO] Outras Intercorr√™ncias Cl√≠nicas na Gesta√ß√£o",
                "[Pediatria] Cirurgia Pedi√°trica no PS",
                "[Pediatria] Uropediatria e H√©rnias",
                "[Pediatria] Malforma√ß√µes Cong√™nitas",
                "[Preventiva] Declara√ß√£o de √ìbito, Atestados e Laudos",
                "[Preventiva] Aten√ß√£o √† Sa√∫de de Popula√ß√µes Espec√≠ficas",
                "[Cirurgia] Videolaparoscopia",
                "[Cirurgia] Eletrocirurgia",
                "[Cirurgia] P√¢ncreas e vias biliares: Tumores Neuroend√≥crinos",
                "[Cirurgia] Nutri√ß√£o perioperat√≥ria",
                "[Cirurgia] Diagn√≥sticos diferenciais das massas cervicais",
                "[Cirurgia] Insufici√™ncia Venosa Cr√¥nica",
                "[Cirurgia] Cirurgia Vascular: S√≠ndromes Compressivas"
            ] 
        },
        { 
            title: "Bloco 22", 
            topics: [
                "[Cl√≠nica M√©dica] Doen√ßas Virais e Pand√™micas",
                "[Cl√≠nica M√©dica] Arboviroses",
                "[Cl√≠nica M√©dica] Icter√≠cias febris e Febre Maculosa",
                "[Cl√≠nica M√©dica] Hepatites Virais",
                "[GO] T√©cnicas de Reprodu√ß√£o Assistida",
                "[GO] Cuidado √† Sa√∫de LGBTQIAPN+",
                "[Pediatria] Medicina do Adolescente",
                "[Pediatria] √âtica em Pediatria",
                "[Preventiva] √âtica M√©dica",
                "[Preventiva] Intoxica√ß√µes, Perda Auditiva Induzida por Ru√≠do (PAIRO) e Burnout",
                "[Preventiva] Dermatologia na APS",
                "[Cirurgia] Tumores do Intestino Delgado",
                "[Cirurgia] Doen√ßas cir√∫rgicas do Ba√ßo",
                "[Cirurgia] CEC de Cabe√ßa e Pesco√ßo",
                "[Cirurgia] Doen√ßas Traqueais",
                "[Cirurgia] Bronquiectasias e Hemoptise"
            ] 
        },
        { 
            title: "Bloco 23", 
            topics: [
                "[Cl√≠nica M√©dica] Hiperaldosteronismo Prim√°rio",
                "[Cl√≠nica M√©dica] Feocromocitoma",
                "[Cl√≠nica M√©dica] Prolactinomas",
                "[Cl√≠nica M√©dica] Oncohematologia",
                "[GO] Cirurgia Ginecol√≥gica: Princ√≠pios e Complica√ß√µes",
                "[GO] Transtornos Psiqui√°tricos na Gesta√ß√£o e P√≥s parto",
                "[Preventiva] Emerg√™ncias Psiqui√°tricas",
                "[Preventiva] Viol√™ncias e Vulnerabilidade",
                "[Preventiva] Sa√∫de Privada, Suplementar e Judicializa√ß√£o em Sa√∫de",
                "[Pediatria] Psiquiatria da Inf√¢ncia e Adolesc√™ncia",
                "[Pediatria] Epilepsias na Inf√¢ncia",
                "[Cirurgia] Cisto pilonidal",
                "[Cirurgia] Anomalias Cong√™nitas em cabe√ßa e pesco√ßo",
                "[Cirurgia] Mediastino"
            ] 
        },
        { 
            title: "Bloco 24", 
            topics: [
                "[Cl√≠nica M√©dica] Dermatologia",
                "[GO] Medicina Fetal",
                "[Pediatria] Otites, Perda Auditiva, Rinossinusites e Epistaxe",
                "[Pediatria] Rinites e Afec√ß√µes da Laringe e Faringe",
                "[Preventiva] Transtornos alimentares, somatoformes e de personalidade",
                "[Cirurgia] Endoscopia",
                "[Cirurgia] Cabe√ßa e Pesco√ßo: Tire√≥ide",
                "[Cirurgia] Cabe√ßa e Pesco√ßo: Paratire√≥ide",
                "[Cirurgia] Neurocirurgia"
            ] 
        },
        { 
            title: "Bloco 25", 
            topics: [
                "[Cl√≠nica M√©dica] Otologia I",
                "[Cl√≠nica M√©dica] Otologia II",
                "[Cl√≠nica M√©dica] Oftalmologia para o Generalista - parte I",
                "[GO] Trombofilias na Gesta√ß√£o e Puerp√©rio",
                "[GO] Doen√ßa Hemol√≠tica Perinatal",
                "[Pediatria] Oftalmopediatria",
                "[Preventiva] Sa√∫de do Trabalhador",
                "[Cirurgia] Anestesiologia"
            ] 
        },
        { 
            title: "Bloco 26", 
            topics: [
                "[Cl√≠nica M√©dica] Rinologia",
                "[Cl√≠nica M√©dica] Bucofaringolaringologia I",
                "[Cl√≠nica M√©dica] Bucofaringolaringologia II",
                "[Cl√≠nica M√©dica] Oftalmologia para o Generalista - parte II",
                "[GO] Outras Urg√™ncias Ginecol√≥gicas",
                "[Pediatria] Malforma√ß√µes do Sistema Nervoso",
                "[Pediatria] Doen√ßas Neuromusculares na Inf√¢ncia",
                "[Preventiva] Transtornos Relacionados a Subst√¢ncias - √Ålcool",
                "[Preventiva] Preventiva: reta final",
                "[Cirurgia] Cirurgia Card√≠aca",
                "[Cirurgia] Tromboelastograma"
            ] 
        }
    ];

    // Vari√°veis locais
    let syllabusMain = DEFAULT_SYLLABUS;
    let syllabusMedcof = DEFAULT_SYLLABUS_MEDCOF;
    
    let progressData = {};
    let notesData = {};
    let simuladosData = {};
    let videoData = {};
    let pdfData = {}; 
    let commentsData = {};
    let simuladosMeta = 70;
    
    let currentEditingId = null;
    let nextTaskGlobal = null;
    let tempManagerSyllabus = [];

    function setGreeting() {
        const hour = new Date().getHours();
        const msgElement = document.getElementById('greetingMsg');
        let greeting = "Ol√°";
        if (hour < 12) greeting = "Bom dia";
        else if (hour < 18) greeting = "Boa tarde";
        else greeting = "Boa noite";
        const displayName = currentUser ? currentUser : "Doutor(a)";
        msgElement.innerText = `${greeting}, Doutor ${displayName}!`;
        updateThemeIcon(document.body.classList.contains('dark-mode'));
    }

    // --- CONTEXT SWITCHING ---
    function switchCourse(course) {
        activeContext = course;
        
        // Atualiza UI das abas
        document.querySelectorAll('.course-tab').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${course}`).classList.add('active');
        
        // Renderiza tudo novamente com o novo contexto
        render();
    }

    function getCurrentSyllabus() {
        return activeContext === 'main' ? syllabusMain : syllabusMedcof;
    }

    function getPrefix() {
        return activeContext === 'main' ? '' : activeContext + '_';
    }

    // --- NOVA FUN√á√ÉO DE SALVAMENTO NO GOOGLE SHEETS ---
    function saveState() {
        // Atualiza a UI primeiro (Dashboard)
        updateDashboard();

        // Envia para o script.google.com salvar na planilha
        if(typeof google !== 'undefined') {
            google.script.run.saveData('progress', JSON.stringify(progressData));
            google.script.run.saveData('notes', JSON.stringify(notesData));
            google.script.run.saveData('simulados', JSON.stringify(simuladosData));
            google.script.run.saveData('videos', JSON.stringify(videoData));
            google.script.run.saveData('pdfData', JSON.stringify(pdfData)); // Save PDFs
            google.script.run.saveData('comments', JSON.stringify(commentsData));
            google.script.run.saveData('meta', simuladosMeta);
        }
    }

    function saveSyllabus() { 
        // Salva na nuvem dependendo do contexto
        if(typeof google !== 'undefined') {
            if(activeContext === 'main') {
                google.script.run.saveData('syllabus', JSON.stringify(syllabusMain));
            } else {
                google.script.run.saveData('syllabus_medcof', JSON.stringify(syllabusMedcof));
            }
        }
        render(); 
    }

    function saveManagerChanges() { 
        if(activeContext === 'main') {
            syllabusMain = JSON.parse(JSON.stringify(tempManagerSyllabus));
        } else {
            syllabusMedcof = JSON.parse(JSON.stringify(tempManagerSyllabus));
        }
        saveSyllabus(); 
        closeAllModals(); 
        alert("Salvo!"); 
    }

    function toggleCheck(id) {
        // Aula -> Simulado Logic
        const parts = id.split('_'); 
        const type = parts[parts.length-1]; // 'aula', 'tarefa', etc.
        
        // Recria o baseId removendo o sufixo (tipo)
        const baseId = id.substring(0, id.lastIndexOf('_')); 

        // Auto-set Date if checking aula
        if(type === 'aula' && !progressData[id]) {
            // Set date to today
            const simId = 's_' + baseId;
            if(!simuladosData[simId]) simuladosData[simId] = {};
            simuladosData[simId].dt_teoria = new Date().toISOString().split('T')[0];
            
            if(confirm("Vamos praticar agora?")) {
                progressData[id] = true;
                saveState();
                
                document.getElementById(id).checked = true;
                const row = document.getElementById(`row_${baseId}`);
                if(row) checkRowCompletion(row);

                activeTopicId = simId; 
                openSimulados();
                return; 
            }
        }

        // Standard Toggle
        if (progressData[id]) delete progressData[id]; else progressData[id] = true;
        const row = document.getElementById(`row_${baseId}`);
        if(row) checkRowCompletion(row);
        saveState();
    }

    function checkRowCompletion(row) {
        const allChecked = Array.from(row.querySelectorAll('input[type="checkbox"]')).every(cb => cb.checked);
        if (allChecked) row.classList.add('completed'); else row.classList.remove('completed');
    }

    function updateDashboard() {
        const currentSyllabus = getCurrentSyllabus();
        const prefix = getPrefix();

        let totalTopics = 0; currentSyllabus.forEach(s => totalTopics += s.topics.length);
        const totalChecks = totalTopics * 4;
        
        // Filtra progresso apenas do contexto atual
        let completedChecks = 0;
        currentSyllabus.forEach((week, wIndex) => {
            week.topics.forEach((topic, tIndex) => {
                const baseId = `${prefix}w${wIndex}_t${tIndex}`;
                ['aula','tarefa','flash','rev'].forEach(k => {
                    if(progressData[`${baseId}_${k}`]) completedChecks++;
                });
            });
        });

        const percentage = totalChecks > 0 ? Math.round((completedChecks / totalChecks) * 100) : 0;
        
        const circle = document.getElementById('circleProgress');
        const offset = 326 - (percentage / 100) * 326;
        circle.style.strokeDashoffset = offset;
        document.getElementById('dashPercent').innerText = `${percentage}%`;
        document.getElementById('dashFraction').innerText = `${completedChecks}/${totalChecks}`;

        let topicsDone = 0; let foundNext = false; nextTaskGlobal = null;
        
        currentSyllabus.forEach((week, wIndex) => {
            week.topics.forEach((topic, tIndex) => {
                const baseId = `${prefix}w${wIndex}_t${tIndex}`;
                if (['aula','tarefa','flash','rev'].every(k => progressData[`${baseId}_${k}`])) topicsDone++;
                else if (!foundNext) { foundNext = true; nextTaskGlobal = { weekIndex: wIndex, topicId: baseId, title: topic, weekTitle: week.title }; }
            });
        });

        // Contagem de Notas do Contexto Atual
        let contextNotesCount = 0;
        currentSyllabus.forEach((week, wIndex) => {
            week.topics.forEach((_, tIndex) => {
                const id = `${prefix}w${wIndex}_t${tIndex}`;
                if(notesData[id]) contextNotesCount++;
            });
        });

        document.getElementById('notesCount').innerText = contextNotesCount;
        document.getElementById('topicCount').innerText = topicsDone;

        const nextTitleEl = document.getElementById('nextTaskTitle');
        const nextWeekEl = document.getElementById('nextTaskWeek');
        const focusBtn = document.getElementById('btnFocus');

        if (nextTaskGlobal) {
            nextTitleEl.innerText = nextTaskGlobal.title;
            nextWeekEl.innerText = `${nextTaskGlobal.weekTitle} - Pendente`;
            focusBtn.style.display = 'flex';
        } else {
            nextTitleEl.innerText = "Parab√©ns!";
            nextWeekEl.innerText = "Cronograma Finalizado.";
            focusBtn.style.display = 'none';
        }
    }

    function goToNextTask() {
        if (!nextTaskGlobal) return;
        const weekCards = document.querySelectorAll('.week-card');
        if (weekCards[nextTaskGlobal.weekIndex]) weekCards[nextTaskGlobal.weekIndex].classList.add('active');
        setTimeout(() => {
            const el = document.getElementById(`row_${nextTaskGlobal.topicId}`);
            if (el) { el.scrollIntoView({ behavior: 'smooth', block: 'center' }); el.style.backgroundColor = '#fef3c7'; setTimeout(() => el.style.backgroundColor = '', 1500); }
        }, 300);
    }

    function toggleWeek(header) { header.parentElement.classList.toggle('active'); }

    function render() {
        const app = document.getElementById('app'); app.innerHTML = '';
        const currentSyllabus = getCurrentSyllabus();
        const prefix = getPrefix();

        currentSyllabus.forEach((week, wIndex) => {
            const weekCard = document.createElement('div'); weekCard.className = 'week-card';
            
            let rows = '';
            week.topics.forEach((topic, tIndex) => {
                const topicId = `${prefix}w${wIndex}_t${tIndex}`;
                let tds = '';
                [{key:'aula',label:'Aula'},{key:'tarefa',label:'Tarefa'},{key:'flash',label:'Flashcard'},{key:'rev',label:'Revis√£o'}].forEach(type => {
                    const uniqueId = `${topicId}_${type.key}`;
                    const checked = progressData[uniqueId] ? 'checked' : '';
                    tds += `<td class="checkbox-cell" data-label="${type.label}"><label class="custom-checkbox cb-${type.key}" title="${type.label}"><input type="checkbox" id="${uniqueId}" ${checked} onchange="toggleCheck('${uniqueId}')"><span class="checkmark"></span></label></td>`;
                });
                
                // Video Logic
                const videos = videoData[topicId];
                const hasVideo = videos && videos.length > 0 ? 'has-video' : '';
                const videoIcon = hasVideo ? '<i class="fas fa-play-circle" style="margin-right:5px;"></i>' : '';
                const clickAction = hasVideo ? `onclick="openPlayer('${topicId}', '${topic.replace(/'/g, "&apos;")}')"` : '';

                rows += `<tr id="row_${topicId}">
                            <td class="topic-title-cell">
                                <div class="topic-title-content">
                                    <button class="note-btn empty" data-id="${topicId}" onclick="openNoteEditor('${topicId}', '${topic.replace(/'/g, "&apos;")}')"><i class="fas fa-pen"></i></button>
                                    <span class="topic-text ${hasVideo}" ${clickAction}>${videoIcon}${topic}</span>
                                </div>
                            </td>
                            ${tds}
                        </tr>`;
            });
            weekCard.innerHTML = `<div class="week-header" onclick="toggleWeek(this)"><span>${week.title}</span><i class="fas fa-chevron-down"></i></div><div class="week-content"><table class="topic-list"><thead><tr><th>T√≥pico</th><th>Aula</th><th>Tarefa</th><th>Flashcard</th><th>Revis√£o</th></tr></thead><tbody>${rows}</tbody></table></div>`;
            app.appendChild(weekCard);
            week.topics.forEach((_, tIndex) => {
                const tid = `${prefix}w${wIndex}_t${tIndex}`;
                updateNoteIcon(tid);
                const row = document.getElementById(`row_${tid}`);
                if(row) checkRowCompletion(row);
            });
        });
        updateDashboard();
    }

    // --- PDF FLOATING WINDOW SYSTEM ---
    
    function handlePDFClick(url) {
        if (url) {
            openPDFViewer(url);
        }
    }

    function openPDFViewer(url) {
        const win = document.getElementById('pdfFloatingWindow');
        const frame = document.getElementById('pdfFrame');
        
        let embedUrl = url;
        if(url.includes('drive.google.com') && url.includes('/view')) {
             embedUrl = url.replace('/view', '/preview');
        }

        frame.src = embedUrl;
        win.style.display = 'flex';
        clearCanvas(); // Reset drawings on open
    }

    function closePDFViewer() {
        document.getElementById('pdfFloatingWindow').style.display = 'none';
        document.getElementById('pdfFrame').src = "";
    }

    function toggleMinimizePDF() {
        const win = document.getElementById('pdfFloatingWindow');
        if(win.style.height === '40px') {
            win.style.height = '700px'; // Restore
            document.querySelector('.fw-body').style.display = 'block';
        } else {
            win.style.height = '40px'; // Minimize
            document.querySelector('.fw-body').style.display = 'none';
        }
    }

    // Draggable Logic
    const fw = document.getElementById('pdfFloatingWindow');
    const header = document.getElementById('fwHeader');
    let isDragging = false, startX, startY, initialLeft, initialTop;

    header.addEventListener('mousedown', (e) => {
        isDragging = true;
        startX = e.clientX;
        startY = e.clientY;
        initialLeft = fw.offsetLeft;
        initialTop = fw.offsetTop;
        document.addEventListener('mousemove', onDrag);
        document.addEventListener('mouseup', stopDrag);
    });

    function onDrag(e) {
        if (!isDragging) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        fw.style.left = `${initialLeft + dx}px`;
        fw.style.top = `${initialTop + dy}px`;
    }

    function stopDrag() {
        isDragging = false;
        document.removeEventListener('mousemove', onDrag);
        document.removeEventListener('mouseup', stopDrag);
    }

    // Highlighter Logic (Canvas Overlay)
    const canvas = document.getElementById('highlightCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let currentColor = null;

    // Resize canvas to match container
    const resizeObserver = new ResizeObserver(() => {
        canvas.width = canvas.parentElement.offsetWidth;
        canvas.height = canvas.parentElement.offsetHeight;
    });
    resizeObserver.observe(document.querySelector('.fw-body'));

    function toggleHighlight(color) {
        const win = document.getElementById('pdfFloatingWindow');
        
        // If clicking same color, toggle off
        if(currentColor === color) {
            currentColor = null;
            win.classList.remove('drawing-mode');
            document.querySelectorAll('.btn-tool').forEach(b => b.classList.remove('active'));
            return;
        }

        currentColor = color;
        win.classList.add('drawing-mode');
        
        // Update Buttons UI
        document.querySelectorAll('.btn-tool').forEach(b => b.classList.remove('active'));
        if(color === 'yellow') document.querySelector('.btn-tool.yellow').classList.add('active');
        if(color === 'blue') document.querySelector('.btn-tool.blue').classList.add('active');

        ctx.lineWidth = 15;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        
        if (color === 'yellow') ctx.strokeStyle = 'rgba(255, 255, 0, 0.4)'; // Transparent Yellow
        if (color === 'blue') ctx.strokeStyle = 'rgba(0, 150, 255, 0.4)'; // Transparent Blue
    }

    canvas.addEventListener('mousedown', (e) => {
        if (!currentColor) return;
        isDrawing = true;
        ctx.beginPath();
        ctx.moveTo(e.offsetX, e.offsetY);
    });

    canvas.addEventListener('mousemove', (e) => {
        if (!isDrawing) return;
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
    });

    canvas.addEventListener('mouseup', () => isDrawing = false);
    
    function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // --- VIDEO & RESOURCE MANAGER ---
    function openVideoManager() {
        const body = document.getElementById('videoManagerBody');
        body.innerHTML = '<div style="padding:20px">';
        
        const currentSyllabus = getCurrentSyllabus();
        const prefix = getPrefix();

        currentSyllabus.forEach((week, wIndex) => {
            body.innerHTML += `<h3 style="margin-top:20px; border-bottom:1px solid #eee; padding-bottom:5px;">${week.title}</h3>`;
            week.topics.forEach((topic, tIndex) => {
                const id = `${prefix}w${wIndex}_t${tIndex}`;
                const videos = videoData[id] || [];
                const pdfs = pdfData[id] || [];
                
                // Video Inputs
                let videoInputsHtml = '';
                videos.forEach((vid, idx) => {
                    videoInputsHtml += `
                        <div style="display:flex; gap:5px; margin-bottom:5px;">
                            <input type="text" class="inp-text" placeholder="Nome da Aula" value="${vid.title}" name="vid_title">
                            <input type="text" class="inp-text" placeholder="Link do Video" value="${vid.url}" name="vid_url" style="flex:2">
                            <button class="btn-icon" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                });

                // PDF Inputs
                let pdfInputsHtml = '';
                pdfs.forEach((pdf, idx) => {
                    pdfInputsHtml += `
                        <div style="display:flex; gap:5px; margin-bottom:5px;">
                            <input type="text" class="inp-text" placeholder="Nome do PDF" value="${pdf.title}" name="pdf_title">
                            <input type="text" class="inp-text" placeholder="Link do PDF (Drive)" value="${pdf.url}" name="pdf_url" style="flex:2">
                            <button class="btn-icon" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                });

                body.innerHTML += `
                    <div id="block_${id}" style="margin-bottom:20px; border-bottom:1px dashed #eee; padding-bottom:10px;">
                        <label style="display:block; font-size:0.9rem; color:var(--text-light); margin-bottom:4px; font-weight:bold;">${topic}</label>
                        
                        <div style="margin-bottom: 10px;">
                            <span style="font-size:0.8rem; font-weight:bold; color:var(--primary);">V√≠deos</span>
                            <div class="video-container">${videoInputsHtml}</div>
                            <button class="btn-secondary" style="padding:2px 8px; font-size:0.7rem; margin-top:5px;" onclick="addVideoInputToContainer(this)">+ V√≠deo</button>
                        </div>

                        <div style="margin-bottom: 10px;">
                            <span style="font-size:0.8rem; font-weight:bold; color:#ef4444;">Materiais (PDF)</span>
                            <div class="pdf-container">${pdfInputsHtml}</div>
                            <button class="btn-secondary" style="padding:2px 8px; font-size:0.7rem; margin-top:5px;" onclick="addPdfInputToContainer(this)">+ PDF</button>
                        </div>

                        <button class="btn-primary" style="padding:5px 15px; font-size:0.8rem; width:100%; justify-content:center;" onclick="saveTopicResources('${id}')">Salvar T√≥pico</button>
                    </div>
                `;
            });
        });
        body.innerHTML += '</div>';
        openModal('videoManagerModal');
    }

    function addVideoInputToContainer(btn) {
        const container = btn.previousElementSibling;
        const div = document.createElement('div');
        div.style.cssText = "display:flex; gap:5px; margin-bottom:5px;";
        div.innerHTML = `
            <input type="text" class="inp-text" placeholder="Nome da Aula" name="vid_title">
            <input type="text" class="inp-text" placeholder="Link do Video" name="vid_url" style="flex:2">
            <button class="btn-icon" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
        `;
        container.appendChild(div);
    }

    function addPdfInputToContainer(btn) {
        const container = btn.previousElementSibling;
        const div = document.createElement('div');
        div.style.cssText = "display:flex; gap:5px; margin-bottom:5px;";
        div.innerHTML = `
            <input type="text" class="inp-text" placeholder="Nome do PDF" name="pdf_title">
            <input type="text" class="inp-text" placeholder="Link do PDF" name="pdf_url" style="flex:2">
            <button class="btn-icon" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>
        `;
        container.appendChild(div);
    }

    function saveTopicResources(id) {
        const block = document.getElementById(`block_${id}`);
        
        // Save Videos
        const vidTitles = block.querySelectorAll('input[name="vid_title"]');
        const vidUrls = block.querySelectorAll('input[name="vid_url"]');
        const newVideos = [];
        vidUrls.forEach((inp, i) => {
            if(inp.value.trim()) {
                newVideos.push({
                    title: vidTitles[i].value.trim() || `Aula ${i+1}`,
                    url: inp.value.trim()
                });
            }
        });

        // Save PDFs
        const pdfTitles = block.querySelectorAll('input[name="pdf_title"]');
        const pdfUrls = block.querySelectorAll('input[name="pdf_url"]');
        const newPdfs = [];
        pdfUrls.forEach((inp, i) => {
            if(inp.value.trim()) {
                let finalUrl = inp.value.trim();
                // Auto-convert Drive View to Preview
                if(finalUrl.includes('drive.google.com') && finalUrl.includes('/view')) {
                    finalUrl = finalUrl.replace('/view', '/preview');
                }
                newPdfs.push({
                    title: pdfTitles[i].value.trim() || `Material ${i+1}`,
                    url: finalUrl
                });
            }
        });
        
        if(newVideos.length > 0) videoData[id] = newVideos; else delete videoData[id];
        if(newPdfs.length > 0) pdfData[id] = newPdfs; else delete pdfData[id];
        
        saveState();
        render();
        alert('Salvo com sucesso!');
    }

    // --- PLAYER & PLAYLIST LOGIC (UPDATED WITH PLAYLIST & COMMENTS) ---
    function openPlayer(id, topicTitle) {
        currentVideoTopicId = id;
        document.getElementById('playerTitle').innerText = topicTitle;
        document.getElementById('userInitial').innerText = currentUser ? currentUser.charAt(0).toUpperCase() : "D";
        
        const videos = videoData[id] || [];
        renderPlaylist(videos);
        renderPlayerResources(id); // New function to render PDF buttons inside player

        openModal('playerModal');
        
        if(videos.length > 0) {
            loadVideoInPlayer(videos[0].url, 0);
        }
    }

    function renderPlayerResources(topicId) {
        const container = document.getElementById('playerResources');
        const pdfs = pdfData[topicId] || [];
        
        if (pdfs.length === 0) {
            container.style.display = 'none';
            container.innerHTML = '';
        } else {
            container.style.display = 'flex';
            let html = '<div class="playlist-header" style="background:#222; border-top:1px solid #333;"><i class="fas fa-paperclip"></i> Material de Apoio</div>';
            pdfs.forEach(pdf => {
                html += `<div class="playlist-item" onclick="handlePDFClick('${pdf.url}')"><i class="fas fa-file-pdf" style="color:#ef4444;"></i> <div class="vid-title">${pdf.title}</div></div>`;
            });
            container.innerHTML = html;
        }
    }

    function renderPlaylist(videos) {
        const playlistContainer = document.getElementById('playerPlaylist');
        playlistContainer.innerHTML = '';
        
        if(videos.length === 0) {
             playlistContainer.innerHTML = `<div style="padding:15px; color:#666;">Nenhuma aula cadastrada.</div>`;
             return;
        }

        videos.forEach((vid, idx) => {
            const isWatched = progressData[`${currentVideoTopicId}_visto_${idx}`];
            const item = document.createElement('div');
            item.className = `playlist-item ${isWatched ? 'watched' : ''}`;
            item.id = `play-item-${idx}`;
            
            // Icon logic
            let iconClass = isWatched ? "fa-check-circle" : "fa-play";
            
            item.innerHTML = `<i class="fas ${iconClass}"></i> <div class="vid-title">${vid.title}</div>`;
            item.onclick = () => loadVideoInPlayer(vid.url, idx);
            playlistContainer.appendChild(item);
        });
    }

    function loadVideoInPlayer(url, idx) {
        currentVideoUrl = url;
        currentVideoIndex = idx;
        
        // UI Updates for Playlist
        document.querySelectorAll('.playlist-item').forEach(i => i.classList.remove('watching'));
        const currentItem = document.getElementById(`play-item-${idx}`);
        if(currentItem) {
            currentItem.classList.add('watching');
            // Change icon to spinner for visual feedback of "playing"
            const icon = currentItem.querySelector('i');
            icon.className = "fas fa-spinner fa-spin"; 
        }

        // Embed Logic
        let embedUrl = url;
        
        // Append autoplay parameter
        let separator = url.includes('?') ? '&' : '?';
        let autoplayParam = "autoplay=1";

        if(url.includes('drive.google.com')) {
            embedUrl = url.replace('/view', '/preview');
            // Google Drive preview doesn't support standard autoplay param in the same way, but let's keep it clean
        } 
        else if (url.includes('youtube.com/watch')) {
            let videoId = url.split('v=')[1]?.split('&')[0];
            embedUrl = `https://www.youtube.com/embed/${videoId}?${autoplayParam}`;
        } 
        else if (url.includes('youtu.be/')) {
            let videoId = url.split('.be/')[1];
            embedUrl = `https://www.youtube.com/embed/${videoId}?${autoplayParam}`;
        }

        document.getElementById('playerScreen').innerHTML = `<iframe src="${embedUrl}" allow="autoplay; fullscreen" allowfullscreen></iframe>`;
        
        // Load comments for this specific video
        renderComments();
    }

    function toggleWatchedStatus() {
        if(currentVideoIndex === -1) return;
        
        const key = `${currentVideoTopicId}_visto_${currentVideoIndex}`;
        const activeItem = document.getElementById(`play-item-${currentVideoIndex}`);
        
        if (progressData[key]) {
            // Unmark
            delete progressData[key];
            if(activeItem) {
                activeItem.classList.remove('watched');
                // Since it's currently playing (watching), keep the watching state visible
                activeItem.classList.add('watching'); 
            }
        } else {
            // Mark
            progressData[key] = true;
            if(activeItem) {
                activeItem.classList.add('watched');
            }
        }
        
        saveState();
        // Re-render playlist to ensure icons are correct based on current state logic
        const videos = videoData[currentVideoTopicId] || [];
        renderPlaylist(videos);
        // Re-apply watching state to current
        loadVideoInPlayer(currentVideoUrl, currentVideoIndex);
    }

    function finishClass() {
        // This function is kept for backward compatibility if called from old code paths, 
        // but now we mainly use toggleWatchedStatus
        if(currentVideoTopicId) {
            closeAllModals();
            if(!progressData[currentVideoTopicId + '_aula']) {
                 toggleCheck(currentVideoTopicId + '_aula');
            } else {
                 if(confirm("Aula conclu√≠da! Vamos praticar agora?")) {
                    activeTopicId = 's_' + currentVideoTopicId; 
                    openSimulados();
                 }
            }
        }
    }

    // --- COMMENTS SYSTEM (APPLE STYLE) ---
    function addComment() {
        const text = document.getElementById('commentText').value.trim();
        if(!text) return;
        
        if(!commentsData[currentVideoUrl]) commentsData[currentVideoUrl] = [];
        
        const newComment = {
            id: Date.now(),
            author: currentUser || "Doutor",
            text: text,
            date: new Date().toLocaleString('pt-BR')
        };
        
        commentsData[currentVideoUrl].unshift(newComment); // Add to top
        document.getElementById('commentText').value = "";
        renderComments();
        saveState();
    }

    function renderComments() {
        const list = document.getElementById('commentList');
        list.innerHTML = "";
        const comments = commentsData[currentVideoUrl] || [];
        
        if(comments.length === 0) {
            list.innerHTML = "<div style='color:#666; font-size:0.8rem; text-align:center; padding:10px;'>Nenhum coment√°rio ainda.</div>";
            return;
        }

        comments.forEach(c => {
            const item = document.createElement('div');
            item.className = 'comment-item';
            item.innerHTML = `
                <div class="apple-avatar">${c.author.charAt(0).toUpperCase()}</div>
                <div class="comment-content">
                    <div class="comment-author">
                        ${c.author}
                        <button class="btn-delete-comment" onclick="deleteComment(${c.id})"><i class="fas fa-trash"></i> Apagar</button>
                    </div>
                    <div class="comment-text">${c.text}</div>
                    <div class="comment-date">${c.date}</div>
                </div>
            `;
            list.appendChild(item);
        });
    }

    function deleteComment(commentId) {
        if(!confirm("Apagar este coment√°rio?")) return;
        commentsData[currentVideoUrl] = commentsData[currentVideoUrl].filter(c => c.id !== commentId);
        renderComments();
        saveState();
    }

    // --- ESTAT√çSTICAS & DESEMPENHO ---
    function openStats() {
        openModal('statsModal');
        calculateStats();
    }

    function calculateStats() {
        let grandTotalT = 0, grandTotalA = 0;
        let r1T = 0, r1A = 0;
        let r2T = 0, r2A = 0;
        let r3T = 0, r3A = 0;
        let debtQuestions = 0;
        let weakTopics = [];

        const currentSyllabus = getCurrentSyllabus();
        const prefix = getPrefix();

        currentSyllabus.forEach((week, wIndex) => {
            week.topics.forEach((topic, tIndex) => {
                const id = `s_${prefix}w${wIndex}_t${tIndex}`;
                const data = simuladosData[id] || {};
                
                const parse = val => parseInt(val) || 0;
                
                const t1 = parse(data.r1_t), a1 = parse(data.r1_a);
                const t2 = parse(data.r2_t), a2 = parse(data.r2_a);
                const t3 = parse(data.r3_t), a3 = parse(data.r3_a);
                
                r1T += t1; r1A += a1;
                r2T += t2; r2A += a2;
                r3T += t3; r3A += a3;
                
                const totalTopicT = t1 + t2 + t3;
                const totalTopicA = a1 + a2 + a3;
                
                grandTotalT += totalTopicT;
                grandTotalA += totalTopicA;

                if(totalTopicT > 0) {
                    const pct = (totalTopicA / totalTopicT) * 100;
                    if(pct < simuladosMeta) {
                        const target = simuladosMeta / 100;
                        let needed = (target * totalTopicT - totalTopicA) / (1 - target);
                        if(needed > 0) debtQuestions += Math.ceil(needed);
                        weakTopics.push({ name: topic, pct: pct });
                    }
                }
            });
        });

        weakTopics.sort((a,b) => a.pct - b.pct);
        const topWeak = weakTopics.slice(0, 5);

        const globalPct = grandTotalT > 0 ? Math.round((grandTotalA / grandTotalT) * 100) : 0;
        const r1Pct = r1T > 0 ? Math.round((r1A / r1T) * 100) : 0;
        const r2Pct = r2T > 0 ? Math.round((r2A / r2T) * 100) : 0;
        const r3Pct = r3T > 0 ? Math.round((r3A / r3T) * 100) : 0;

        const content = document.getElementById('statsContent');
        content.innerHTML = `
            <div class="stats-grid">
                <div class="stat-card-big">
                    <div class="stat-title">Taxa de Acerto Global (${activeContext === 'main' ? 'Extensivo' : 'Medcof'}) <i class="fas fa-globe-americas"></i></div>
                    <span class="stat-highlight">${globalPct}%</span>
                    <span class="stat-subtext">${grandTotalA} acertos de ${grandTotalT} quest√µes</span>
                    <div class="bar-chart">
                        <div class="bar-item">
                            <div class="bar-track"><div class="bar-fill" style="width:${globalPct}%"></div></div>
                        </div>
                    </div>
                </div>
                <div class="stat-card-big">
                    <div class="stat-title">D√≠vida de Quest√µes <i class="fas fa-balance-scale-right"></i></div>
                    <span class="stat-highlight" style="color:var(--danger-text)">${debtQuestions}</span>
                    <span class="stat-subtext">Acertos seguidos necess√°rios para atingir ${simuladosMeta}% nos temas fracos.</span>
                </div>
                <div class="stat-card-big">
                    <div class="stat-title">Por Revis√£o <i class="fas fa-layer-group"></i></div>
                    <div class="bar-chart">
                        <div class="bar-item"><span class="bar-label">R1</span><div class="bar-track"><div class="bar-fill" style="width:${r1Pct}%"></div></div><span class="bar-val">${r1Pct}%</span></div>
                        <div class="bar-item"><span class="bar-label">R2</span><div class="bar-track"><div class="bar-fill" style="width:${r2Pct}%"></div></div><span class="bar-val">${r2Pct}%</span></div>
                        <div class="bar-item"><span class="bar-label">R3</span><div class="bar-track"><div class="bar-fill" style="width:${r3Pct}%"></div></div><span class="bar-val">${r3Pct}%</span></div>
                    </div>
                </div>
                <div class="stat-card-big">
                    <div class="stat-title">Temas de Aten√ß√£o üö®</div>
                    <ul style="padding-left:20px; font-size:0.9rem; color:var(--text-light);">
                        ${topWeak.length ? topWeak.map(t => `<li><b>${Math.round(t.pct)}%</b> - ${t.name}</li>`).join('') : '<li>Nenhum tema cr√≠tico identificado!</li>'}
                    </ul>
                </div>
            </div>
        `;
    }

    // --- SIMULADOS ---
    function openSimulados() {
        document.getElementById('metaInput').value = simuladosMeta;
        openModal('simuladosModal');
        renderSimuladosTable();
        if(activeTopicId) {
            setTimeout(() => {
                const el = document.getElementById(activeTopicId);
                if(el) el.scrollIntoView({behavior: "smooth", block: "center"});
            }, 300);
        }
    }

    function saveMeta(val) {
        simuladosMeta = val;
        saveState();
        renderSimuladosTable();
    }

    function renderSimuladosTable() {
        const tbody = document.getElementById('simuladosTableBody');
        let html = `<thead><tr class="sim-header-group"><th rowspan="2">T√≥pico</th><th rowspan="2">Data Teoria</th><th colspan="4">1¬™ Revis√£o (24h)</th><th colspan="4">2¬™ Revis√£o (7d)</th><th colspan="4">3¬™ Revis√£o (30d)</th><th rowspan="2">Status</th><th colspan="4">Desempenho</th><th rowspan="2">Sugest√£o!</th></tr><tr><th>Data</th><th>T</th><th>A</th><th>%</th><th>Data</th><th>T</th><th>A</th><th>%</th><th>Data</th><th>T</th><th>A</th><th>%</th><th>R1%</th><th>R2%</th><th>R3%</th><th>Global</th></tr></thead><tbody>`;

        const currentSyllabus = getCurrentSyllabus();
        const prefix = getPrefix();

        currentSyllabus.forEach((week, wIndex) => {
            html += `<tr><td colspan="19" style="background:var(--hover-bg); font-weight:bold; text-align:left; padding-left:10px;">${week.title}</td></tr>`;
            week.topics.forEach((topic, tIndex) => {
                const id = `s_${prefix}w${wIndex}_t${tIndex}`;
                const data = simuladosData[id] || {};
                const inp = (f, t="text") => `<input type="${t}" value="${data[f]||''}" onchange="updateSimulado('${id}', '${f}', this.value)">`;
                
                const calcPct = (t, a) => (t && a) ? Math.round((a/t)*100) : null;
                const p1 = calcPct(data.r1_t, data.r1_a), p2 = calcPct(data.r2_t, data.r2_a), p3 = calcPct(data.r3_t, data.r3_a);
                
                let totalT = (parseInt(data.r1_t)||0) + (parseInt(data.r2_t)||0) + (parseInt(data.r3_t)||0);
                let totalA = (parseInt(data.r1_a)||0) + (parseInt(data.r2_a)||0) + (parseInt(data.r3_a)||0);
                let globalPct = totalT > 0 ? Math.round((totalA/totalT)*100) : 0;
                let globalDisplay = totalT > 0 ? globalPct + '%' : '-';

                let metaSugestao = '';
                let rowClass = ''; 

                if(id === activeTopicId) {
                    rowClass = 'sim-row-active'; 
                } else if(totalT > 0) {
                    if (globalPct < simuladosMeta) {
                        rowClass = 'sim-row-danger'; 
                    } else {
                        rowClass = 'sim-row-success'; 
                    }
                }

                if(totalT > 0 && globalPct < simuladosMeta) {
                    const target = simuladosMeta / 100;
                    const needed = Math.ceil((target * totalT - totalA) / (1 - target));
                    if(needed > 0) metaSugestao = `\nüéØ Faltam ${needed} acertos!`;
                } else if (totalT > 0) {
                    metaSugestao = `\n‚≠ê Meta batida!`;
                }

                let dateSugestao = '';
                if(data.dt_teoria) {
                    const dt = new Date(data.dt_teoria);
                    if(!data.r1_dt) { 
                        dt.setDate(dt.getDate()+1); 
                        dateSugestao = `‚è≥ R1: ${dt.toLocaleDateString()}`; 
                    } else if (!data.r2_dt) { 
                        const d = new Date(data.r1_dt); d.setDate(d.getDate()+7); 
                        dateSugestao = `‚è≥ R2: ${d.toLocaleDateString()}`; 
                    } else if (!data.r3_dt) { 
                        const d = new Date(data.r2_dt); d.setDate(d.getDate()+30); 
                        dateSugestao = `‚è≥ R3: ${d.toLocaleDateString()}`; 
                    } else {
                        dateSugestao = "‚úÖ Conclu√≠do";
                    }
                }

                let statusIcon = '‚ö™';
                if(totalT > 0) statusIcon = globalPct >= simuladosMeta ? '<span class="status-ok">‚úÖ</span>' : '<span class="status-bad">‚ùå</span>';

                html += `<tr class="${rowClass}" id="${id}"><td style="text-align:left;">${topic}</td><td>${inp('dt_teoria','date')}</td>
                <td>${inp('r1_dt','date')}</td><td>${inp('r1_t','number')}</td><td>${inp('r1_a','number')}</td><td style="background:var(--hover-bg)">${p1?p1+'%':'-'}</td>
                <td>${inp('r2_dt','date')}</td><td>${inp('r2_t','number')}</td><td>${inp('r2_a','number')}</td><td style="background:var(--hover-bg)">${p2?p2+'%':'-'}</td>
                <td>${inp('r3_dt','date')}</td><td>${inp('r3_t','number')}</td><td>${inp('r3_a','number')}</td><td style="background:var(--hover-bg)">${p3?p3+'%':'-'}</td>
                <td>${statusIcon}</td>
                <td>${p1?p1+'%':'-'}</td><td>${p2?p2+'%':'-'}</td><td>${p3?p3+'%':'-'}</td><td style="font-weight:bold;">${globalDisplay}</td>
                <td class="sugestao-box">${dateSugestao}${metaSugestao}</td></tr>`;
            });
        });
        tbody.innerHTML = html + '</tbody>';
    }

    function updateSimulado(id, f, v) {
        if(!simuladosData[id]) simuladosData[id]={};
        simuladosData[id][f]=v; 
        saveState(); 
        renderSimuladosTable();
    }

    // --- MODALS & EDITOR ---
    function openModal(id) { document.getElementById('modalOverlay').style.display='block'; document.getElementById(id).style.display='flex'; setupToolbarListeners(); }
    function closeAllModals() { document.getElementById('modalOverlay').style.display='none'; document.querySelectorAll('.modal-window').forEach(m=>m.style.display='none'); }
    function setupToolbarListeners() { document.querySelectorAll('.editor-toolbar button, .color-dot').forEach(b=>b.onmousedown=e=>e.preventDefault()); }
    
    function openNoteEditor(id, title) { currentEditingId=id; document.getElementById('noteTopicTitle').innerText=title; document.getElementById('editorContent').innerHTML=notesData[id]||''; openModal('noteModal'); }
    
    function saveCurrentNote() { 
        if(!currentEditingId) return; 
        
        const editor = document.getElementById('editorContent');
        const htmlContent = editor.innerHTML;
        const textContent = editor.innerText.trim();
        const hasImages = editor.querySelector('img');

        // VALIDA√á√ÉO CORRIGIDA: Se n√£o tiver texto E n√£o tiver imagem, deleta.
        if((!textContent && !hasImages) || htmlContent === '<br>') {
            delete notesData[currentEditingId];
        } else {
            notesData[currentEditingId] = htmlContent; 
        }

        saveState(); 
        updateNoteIcon(currentEditingId); 
        
        if(document.getElementById('readNoteModal').style.display==='flex') document.getElementById('readNoteContent').innerHTML = htmlContent; 
        else closeAllModals(); 
    }
    
    function updateNoteIcon(id) { const b=document.querySelector(`button[data-id="${id}"]`); if(b) { if(notesData[id]) { b.className='note-btn has-note'; b.innerHTML='<i class="fas fa-book-open"></i>'; } else { b.className='note-btn empty'; b.innerHTML='<i class="fas fa-pen"></i>'; } } }
    function formatDoc(c,v=null) { if(c==='hiliteColor'&&!document.queryCommandSupported('hiliteColor')) c='backColor'; document.execCommand(c,false,v); document.getElementById('editorContent').focus(); }

    function openAllNotes() {
        const c = document.getElementById('notesListContainer'); c.innerHTML='';
        const keys = Object.keys(notesData);
        if(keys.length===0) c.innerHTML='<div style="text-align:center; padding:20px; color:var(--text-light);"><i class="fas fa-wind" style="font-size:2rem; margin-bottom:10px; display:block;"></i>Nenhum resumo salvo.</div>';
        else keys.forEach(id => {
            const prefix = getPrefix();
            // Verifica se a nota pertence ao contexto atual
            if ((activeContext === 'main' && !id.includes('_')) || (activeContext !== 'main' && id.startsWith(prefix))) {
                // Parse ID
                const cleanId = activeContext === 'main' ? id : id.replace(prefix, '');
                const [w,t] = cleanId.replace('w','').split('_t').map(Number);
                
                const currentSyllabus = getCurrentSyllabus();
                
                if(currentSyllabus[w] && currentSyllabus[w].topics[t]) {
                    const title = currentSyllabus[w].topics[t];
                    const week = currentSyllabus[w].title;
                    const div = document.createElement('div'); div.className='notes-list-item';
                    div.innerHTML = `<div><div class="note-meta">${week}</div><div class="note-title">${title}</div></div><div class="note-actions"><button class="btn-icon btn-icon-blue" onclick="openReadNote('${id}','${title.replace(/'/g,"&apos;")}')"><i class="fas fa-file-alt"></i></button><button class="btn-icon" onclick="openNoteEditor('${id}','${title.replace(/'/g,"&apos;")}')"><i class="fas fa-pen"></i></button><button class="btn-icon" onclick="deleteNote('${id}')"><i class="fas fa-trash"></i></button></div>`;
                    c.appendChild(div);
                }
            }
        });
        openModal('notesListModal');
    }
    
    function deleteNote(id) { 
        if(confirm("Tem certeza que deseja apagar este resumo?")) { 
            delete notesData[id]; 
            saveState(); 
            updateNoteIcon(id); 
            openAllNotes(); 
        } 
    }

    function openReadNote(id, title) { document.getElementById('notesListModal').style.display='none'; document.getElementById('readNoteTitle').innerText=title; document.getElementById('readNoteContent').innerHTML=notesData[id]; document.getElementById('btnEditFromRead').onclick=()=> { document.getElementById('readNoteModal').style.display='none'; openNoteEditor(id, title); }; openModal('readNoteModal'); }
    function printElement(e) { const c=document.getElementById(e).innerHTML; const t=document.getElementById('readNoteTitle').innerText; const w=window.open('','','height=600,width=800'); w.document.write('<html><head><title>'+t+'</title><style>body{font-family:Georgia,serif;padding:40px;line-height:1.6;}</style></head><body><h1>'+t+'</h1>'+c+'</body></html>'); w.document.close(); w.print(); }

    // --- MANAGER ---
    function openManager() { 
        const currentSyllabus = getCurrentSyllabus();
        tempManagerSyllabus = JSON.parse(JSON.stringify(currentSyllabus)); 
        renderManagerBody(); 
        openModal('managerModal'); 
    }
    
    function renderManagerBody() {
        const c = document.getElementById('managerBody'); c.innerHTML='<ul class="manager-list"></ul>';
        const l = c.querySelector('ul');
        tempManagerSyllabus.forEach((week, wi) => {
            const li = document.createElement('li'); li.className='manager-week';
            li.innerHTML=`<div class="manager-week-header"><i class="fas fa-calendar-week" style="color:var(--text-light)"></i><input type="text" class="inp-text" value="${week.title}" onchange="updateWeekTitle(${wi},this.value)"><button class="btn-icon" onclick="removeWeekInManager(${wi})"><i class="fas fa-trash"></i></button></div><div class="manager-week-body"><ul class="manager-topic-list" id="m-week-${wi}"></ul><button class="btn-icon btn-add" onclick="addTopicInManager(${wi})"><i class="fas fa-plus"></i> Adicionar T√≥pico</button></div>`;
            l.appendChild(li);
            const tl = document.getElementById(`m-week-${wi}`);
            week.topics.forEach((top, ti) => {
                const tli = document.createElement('li'); tli.className='manager-topic-item';
                tli.innerHTML=`<i class="fas fa-circle" style="font-size:0.5rem; color:#cbd5e1;"></i><input type="text" class="inp-text" value="${top}" onchange="updateTopicTitle(${wi},${ti},this.value)"><button class="btn-icon" onclick="removeTopicInManager(${wi},${ti})"><i class="fas fa-times"></i></button>`;
                tl.appendChild(tli);
            });
        });
    }
    function updateWeekTitle(i,v) { tempManagerSyllabus[i].title=v; }
    function updateTopicTitle(wi,ti,v) { tempManagerSyllabus[wi].topics[ti]=v; }
    function addWeekInManager() { tempManagerSyllabus.push({title:`Semana ${tempManagerSyllabus.length+1}`,topics:["Novo T√≥pico"]}); renderManagerBody(); }
    function removeWeekInManager(i) { if(confirm("Excluir semana?")) { tempManagerSyllabus.splice(i,1); renderManagerBody(); } }
    function addTopicInManager(i) { tempManagerSyllabus[i].topics.push("Novo T√≥pico"); renderManagerBody(); }
    function removeTopicInManager(wi,ti) { tempManagerSyllabus[wi].topics.splice(ti,1); renderManagerBody(); }
    
    function resetAll() { 
        if(confirm("Apagar TUDO da aba atual?")) { 
            // Limpa apenas dados da aba atual
            const prefix = getPrefix();
            
            // Filtra e deleta keys que come√ßam com o prefixo (ou n√£o tem, se for main)
            const cleanObj = (obj) => {
                Object.keys(obj).forEach(key => {
                    const isMainKey = !key.includes('_') || (!key.startsWith('medcof_') && activeContext === 'main');
                    const isMedcofKey = key.startsWith('medcof_') && activeContext === 'medcof';
                    
                    // L√≥gica simplificada: Se activeContext √© 'main', deleta keys sem prefixo especial.
                    // Se activeContext √© 'medcof', deleta keys com 'medcof_'
                    
                    if (activeContext === 'main') {
                        // Deleta se N√ÉO come√ßar com medcof_
                        if (!key.startsWith('medcof_')) delete obj[key];
                    } else {
                        // Deleta se come√ßar com medcof_
                        if (key.startsWith('medcof_')) delete obj[key];
                    }
                });
            };

            cleanObj(progressData);
            cleanObj(notesData);
            cleanObj(simuladosData);
            cleanObj(videoData);
            cleanObj(pdfData);
            
            // Restaura Syllabus Default
            if (activeContext === 'main') syllabusMain = JSON.parse(JSON.stringify(DEFAULT_SYLLABUS));
            else syllabusMedcof = JSON.parse(JSON.stringify(DEFAULT_SYLLABUS_MEDCOF));

            saveState(); // Salva estado vazio na nuvem
            saveSyllabus();
            render(); 
        } 
    }

    function toggleMaximize(id) {
        document.getElementById(id).classList.toggle('maximized');
    }

    setupToolbarListeners();
</script>
</body>
</html>